(this.webpackJsonp=this.webpackJsonp||[]).push([[83],{4363:function(e,t,a){"use strict";a.r(t),a.d(t,"useAddressBook",(function(){return B}));var n=a(57),r=a(270),s=a(49),d=a(194),o=a(78),c=a(195),i=a(92),u=a(11),l=a(26),f=a(45),b=a(263),j=a(1),m=a(42),O=a(89),p=a(168),h=a(24),g=a(16),v=a(1084),_=a(3),x=a.n(_),y=a(15),w=a.n(y),k=a(17),C=a(1091),A=a(186),M=a(0),P=["contact"];function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var I=function(e){var t=e.contact,a=w()(e,P),n=Object(O.default)(),r=t.name,s=t.address,d=t.networkId,o=t.id,c=Object(m.useNavigation)(),i=Object(j.useCallback)((function(){c.navigate(g.RootRoutes.Modal,{screen:g.ModalRoutes.AddressBook,params:{screen:v.AddressBookRoutes.EditAddressRoute,params:{uuid:o,defaultValues:{name:r,address:s,networkId:d}}}})}),[c,r,s,d,o]),u=Object(j.useCallback)((function(){setTimeout((function(){Object(p.copyToClipboard)(s),f.default.show({title:n.formatMessage({id:"msg__address_copied"})})}),200)}),[n,s]),l=Object(j.useCallback)((function(){k.default.dispatch(Object(C.remove)({uuid:o})),f.default.show({title:n.formatMessage({id:"msg__address_deleted"})})}),[o,n]),b=Object(j.useMemo)((function(){return[{id:"action__edit",onPress:i,icon:"PencilMini"},{id:"action__copy_address",onPress:u,icon:"Square2StackOutline"},{id:"action__delete",onPress:l,icon:"TrashMini",variant:"desctructive"}]}),[u,l,i]);return Object(M.jsx)(A.default,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){x()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({w:190,options:b},a))},R=function(e){var t=e.networkId,a=e.onNew,n=e.onSelected,g=Object(O.default)(),v=Object(h.useAppSelector)((function(e){return e.contacts.contacts})),_=Object(b.default)().bottom,x=Object(j.useMemo)((function(){var e=Object.values(v);if(e=e.sort((function(e,t){return e.createAt,t.createAt,-1})),t){var a=t.split("--")[0];e=e.filter((function(e){return e.badge.toUpperCase()===a.toUpperCase()}))}return e}),[v,t]),y=Object(j.useCallback)((function(e){Object(p.copyToClipboard)(e),f.default.show({title:g.formatMessage({id:"msg__address_copied"})})}),[g]),w=Object(m.useNavigation)(),k=Object(j.useCallback)((function(e){n&&(null==n||n({address:e.address,name:e.name}),w.goBack())}),[n,w]),C=Object(j.useCallback)((function(e){var t=e.item,a=t.name,n=t.badge,r=t.address;return Object(M.jsxs)(i.default,{onLongPress:function(){y(r)},onPress:function(){return k(t)},children:[Object(M.jsx)(i.default.Column,{children:Object(M.jsx)(u.default,{w:"40px",h:"40px",borderRadius:"full",bg:"decorative-surface-one",justifyContent:"center",alignItems:"center",children:Object(M.jsx)(l.default.Body2,{color:"decorative-icon-one",children:a.toUpperCase()[0]})})}),Object(M.jsx)(i.default.Column,{flex:1,text:{label:Object(M.jsxs)(u.default,{flexDirection:"row",alignItems:"center",children:[Object(M.jsx)(l.default.Body1Strong,{mr:"8px",isTruncated:!0,children:a}),Object(M.jsx)(c.default,{size:"sm",title:n.toUpperCase()})]}),description:Object(M.jsx)(l.default.Body2,{color:"text-subdued",children:r})}}),Object(M.jsx)(i.default.Column,{children:Object(M.jsx)(I,{contact:t,children:Object(M.jsx)(o.default,{name:"EllipsisVerticalMini",circle:!0,type:"plain"})})})]})}),[y,k]);return 0===x.length?Object(M.jsx)(s.default,{w:"full",h:"full",children:Object(M.jsx)(d.default,{title:g.formatMessage({id:"title__no_cantact"}),subTitle:g.formatMessage({id:"title__no_cantact_desc"}),actionTitle:g.formatMessage({id:"action__add_new_address"}),actionProps:{leftIconName:"PlusMini"},handleAction:a,emoji:"\ud83d\udcc7"})}):Object(M.jsx)(r.default,{data:x,renderItem:C,keyExtractor:function(e){return String(e.id)},ListFooterComponent:_>0?Object(M.jsx)(u.default,{h:_+"px"}):null})};function B(){var e=Object(m.useNavigation)();return{showAddressBookModal:Object(j.useCallback)((function(t){e.navigate(g.RootRoutes.Modal,{screen:g.ModalRoutes.AddressBook,params:{screen:v.AddressBookRoutes.NewPickAddressRoute,params:t}})}),[e])}}t.default=function(){var e,t=Object(O.default)(),a=null!=(e=Object(m.useRoute)().params)?e:{},r=a.networkId,s=a.onSelected,d=Object(m.useNavigation)(),c=Object(j.useCallback)((function(){d.navigate(v.AddressBookRoutes.NewAddressRoute)}),[d]);return Object(M.jsx)(n.default,{rightContent:Object(M.jsx)(o.default,{onPress:c,name:"PlusCircleOutline",type:"plain",size:"lg",circle:!0}),header:t.formatMessage({id:"title__contacts"}),hideSecondaryAction:!0,footer:null,height:"480px",children:Object(M.jsx)(R,{networkId:r,onSelected:s,onNew:c})})}},5325:function(e,t,a){"use strict";a.r(t);var n=a(50),r=a(45),s=a(1),d=a(42),o=a(89),c=a(17),i=a(48),u=a(1091),l=a(3),f=a.n(l),b=a(57),j=a(11),m=a(43),O=a(2),p=a.n(O),h=a(121),g=a(15),v=a.n(g),_=a(809),x=a(35),y=a(1105),w=a(1169),k=a(24),C=a(0),A=["defaultValues","header","showAlert","onSubmit","editing"];function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var P=function(e){var t=e.defaultValues,a=e.header,r=(e.showAlert,e.onSubmit),d=e.editing,i=v()(e,A),u=Object(o.default)(),l=Object(s.useRef)(),O=Object(k.useAppSelector)((function(e){return e.contacts.contacts})),g=Object(s.useMemo)((function(){return new Map(Object.values(O).map((function(e){return[e.address.toLowerCase(),e]})))}),[O]),P=Object(h.default)({defaultValues:t,mode:"onChange"}),S=P.control,I=P.handleSubmit,R=P.setValue,B=P.watch,N=P.trigger,E=P.formState.isValid,T=B("name"),D=B("address"),V=B("networkId"),L=Object(n.default)(),q=Object(_.useNameServiceStatus)(),U=q.onChange,F=q.disableSubmitBtn,z=q.address,H=q.name,W=Object(k.useDebounce)(D,300),J=z||W;Object(s.useEffect)((function(){function e(){return(e=p()((function*(){if(J&&V)try{yield c.default.validator.validateAddress(V,J.trim()),l.current=!1,N("address")}catch(e){l.current=!0,N("address")}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[J,V,N,u]),Object(s.useEffect)((function(){T.length>24&&R("name",T.slice(0,24)),H&&!T&&R("name",H)}),[T,R,H]),Object(s.useEffect)((function(){D.length>103&&R("address",D.slice(0,103))}),[D,R]);var G=Object(s.useCallback)((function(e){U(e),N("address")}),[N,U]),K=Object(s.useCallback)((function(e){return Object(C.jsx)(_.default,{name:e,onChange:G,disableBTC:!1,networkId:V})}),[G,V]);return Object(C.jsx)(b.default,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach((function(t){f()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({header:a,hideSecondaryAction:!0,primaryActionProps:{isDisabled:!E||F,onPress:function(){return I((function(e){return!F&&z&&(e.address=z),r(e)}))()}},scrollViewProps:{children:Object(C.jsx)(j.default,{w:"full",h:"full",children:Object(C.jsxs)(m.default,{children:[Object(C.jsx)(w.default,{hideHelpText:!0,control:S,name:"networkId",disabledNetworkIds:[x.OnekeyNetwork.lightning]}),Object(C.jsx)(m.default.Item,{control:S,name:"name",label:u.formatMessage({id:"form__contact_name"}),rules:{required:{value:!0,message:u.formatMessage({id:"form__field_is_required"})}},children:Object(C.jsx)(m.default.Input,{size:L?"xl":"default"})}),Object(C.jsx)(m.default.Item,{control:S,name:"address",label:u.formatMessage({id:"form__address"}),helpText:K,rules:{required:{value:!0,message:u.formatMessage({id:"form__field_is_required"})},validate:function(e){var a=(null==z?void 0:z.toLowerCase())||(null==e?void 0:e.toLowerCase()),n=t.address.toLowerCase();if(a)return!d&&g.get(a)||d&&g.get(a)&&a!==n?u.formatMessage({id:"msg__this_address_already_exists"}):l.current?u.formatMessage({id:"form__address_invalid"}):void 0}},children:Object(C.jsx)(y.default,{})})]})})}},i))},S=function(){var e=Object(o.default)(),t=Object(d.useNavigation)(),a=Object(d.useRoute)(),n=Object(i.useNetworks)(),l=a.params,f=l.defaultValues,b=l.uuid,j=Object(s.useCallback)((function(a){var s=n.find((function(e){return e.id===a.networkId}));s&&(c.default.dispatch(Object(u.update)({uuid:b,contact:{name:a.name,address:a.address,badge:s.impl,networkId:s.id}})),c.default.serviceCloudBackup.requestBackup(),r.default.show({title:e.formatMessage({id:"msg__address_changed"})}),t.goBack())}),[n,t,b,e]);return Object(C.jsx)(P,{defaultValues:{address:f.address,name:f.name,networkId:f.networkId},onSubmit:j,header:e.formatMessage({id:"title__edit_address"}),primaryActionTranslationId:"action__save",editing:!0})},I=function(){var e,t=Object(o.default)(),a=Object(d.useNavigation)(),n=null!=(e=Object(d.useRoute)().params)?e:{},i=n.onSelected,u=n.networkId,l=n.defaultAddress,f=Object(h.default)({defaultValues:{address:null!=l?l:""},mode:"onChange"}),j=f.control,O=f.watch,g=f.trigger,v=f.setError,_=f.setValue,x=f.handleSubmit,w=f.formState.isValid,A=Object(k.useDebounce)(O("address"),300);Object(s.useEffect)((function(){function e(){return(e=p()((function*(){if(A&&u)try{yield c.default.validator.validateAddress(u,A.trim()),g("address")}catch(e){v("address",{message:t.formatMessage({id:"form__address_invalid"})})}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[A,u,g,v,t]);var M=Object(s.useCallback)(function(){var e=p()((function*(e){if(u)try{yield c.default.validator.validateAddress(u,e.address.trim())}catch(n){return void r.default.show({title:t.formatMessage({id:"form__address_invalid"})})}null==i||i({address:e.address.trim(),name:e.name}),a.goBack()}));return function(t){return e.apply(this,arguments)}}(),[a,i,t,u]);return Object(C.jsx)(b.default,{header:t.formatMessage({id:"form__enter_address"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__confirm",primaryActionProps:{isDisabled:!w,onPress:function(){return x(M)()}},children:Object(C.jsx)(m.default.Item,{control:j,name:"address",rules:{required:{value:!0,message:t.formatMessage({id:"form__field_is_required"})}},children:Object(C.jsx)(y.default,{networkId:u,onChangeAddressName:function(e){return _("name",e)},plugins:["contact","paste","scan"]})})})},R=a(4363),B=function(){var e=Object(o.default)(),t=Object(d.useNavigation)(),a=(Object(d.useRoute)().params||{}).address,n=void 0===a?"":a,l=Object(i.useNetworks)(),f=Object(s.useCallback)(function(){var a=p()((function*(a){var n=l.find((function(e){return e.id===a.networkId}));if(a.networkId)try{yield c.default.validator.validateAddress(a.networkId,a.address)}catch(s){return void r.default.show({title:e.formatMessage({id:"form__address_invalid"})})}n&&(c.default.dispatch(Object(u.create)({name:a.name,address:a.address,badge:n.impl,networkId:n.id})),c.default.serviceCloudBackup.requestBackup(),r.default.show({title:e.formatMessage({id:"msg__address_added"})},{}),t.goBack())}));return function(e){return a.apply(this,arguments)}}(),[l,t,e]);return Object(C.jsx)(P,{defaultValues:{address:n,name:""},onSubmit:f,header:e.formatMessage({id:"action__add_new_address"}),showAlert:!0,primaryActionTranslationId:"action__add"})},N=a(423),E=a(581),T=a(13),D=a.n(T),V=a(482),L=a(49),q=a(194),U=a(60),F=a(195),z=a(26),H=a(4),W=a.n(H),J=a(100),G=a(101),K=a(79),Q=a(167),X=a(483),Y=a(1084),Z=function(){return Object(C.jsx)(j.default,{mx:{base:4,md:6},children:Object(C.jsx)(J.default,{})})},$=function(e){var t,a=e.addressFilter,n=Object(o.default)(),r=Object(d.useNavigation)(),c=null!=(t=Object(d.useRoute)().params)?t:{},i=c.networkId,u=c.onSelected,l=Object(k.useAppSelector)((function(e){return e.contacts.contacts})),f=Object(s.useState)([]),b=W()(f,2),m=b[0],O=b[1],h=Object(s.useCallback)(function(){var e=p()((function*(e){if(a){var t=e.map(function(){var e=p()((function*(e){return{value:e,isVaild:yield a(e.address)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(t)).filter((function(e){return e.isVaild})).map((function(e){return e.value}))}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),[a]);Object(s.useEffect)((function(){function e(){return(e=p()((function*(){var e=Object.values(l);if(e=e.sort((function(e,t){return e.createAt,t.createAt,-1})),i){var t=i.split("--")[0];e=e.filter((function(e){return e.badge.toUpperCase()===t.toUpperCase()}))}(e=yield h(e))&&e.length>0&&O(e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[l,h,i]);var g=Object(s.useCallback)((function(e){null==u||u({address:e.address,name:e.name}),r.goBack()}),[u,r]),v=Object(s.useCallback)((function(e){var t=e.item,a=e.index;return Object(C.jsxs)(U.default,{py:"4",px:"4",mx:{base:4,md:6},flexDirection:"row",alignItems:"center",bg:"surface-default",borderTopRadius:0===a?"12":void 0,borderBottomRadius:a===m.length-1?"12":void 0,onPress:function(){return g(t)},children:[Object(C.jsx)(j.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",justifyContent:"center",alignItems:"center",children:Object(C.jsx)(z.default.DisplaySmall,{color:"decorative-icon-one",children:t.name.toUpperCase()[0]})}),Object(C.jsxs)(j.default,{flex:"1",ml:"4",children:[Object(C.jsxs)(j.default,{flexDirection:"row",children:[Object(C.jsx)(z.default.Body1Strong,{mr:"2",numberOfLines:1,maxWidth:"80%",children:t.name}),Object(C.jsx)(F.default,{size:"sm",title:t.badge.toUpperCase()})]}),Object(C.jsx)(j.default,{children:Object(C.jsx)(z.default.Body2,{color:"text-subdued",numberOfLines:2,children:t.address})})]})]})}),[m,g]),_=Object(s.useMemo)((function(){return Object(C.jsx)(L.default,{w:"full",h:"full",children:Object(C.jsx)(q.default,{title:n.formatMessage({id:"title__no_cantact"}),subTitle:n.formatMessage({id:"title__no_cantact_desc"}),emoji:"\ud83d\udcc7"})})}),[n]);return Object(C.jsx)(V.default,{ListEmptyComponent:_,data:m,ItemSeparatorComponent:Z,renderItem:v,keyExtractor:function(e){return e.address}})},ee=function(e){var t,a=e.addressFilter,n=Object(o.default)(),r=Object(i.useRuntime)().wallets,u=Object(d.useNavigation)(),l=null!=(t=Object(d.useRoute)().params)?t:{},f=l.networkId,b=l.onSelected,m=Object(s.useState)([]),O=W()(m,2),h=O[0],g=O[1],v=Object(s.useCallback)(function(){var e=p()((function*(e){if(a){var t=e.map(function(){var e=p()((function*(e){return{value:e,isVaild:yield a(e.address)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(t)).filter((function(e){return e.isVaild})).map((function(e){return e.value}))}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),[a]);Object(s.useEffect)((function(){function e(){return(e=p()((function*(){for(var e=function*(){var e=r[t],a=yield c.default.engine.getAccounts(e.accounts,f);(a=yield v(a))&&a.length>0&&g((function(t){return[].concat(D()(t),[{wallet:e,data:a,key:e.id}])}))},t=0;t<r.length;t+=1)yield*e()}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[v]);var _=Object(s.useCallback)((function(e){null==b||b({address:e.address,name:e.name}),u.goBack()}),[b,u]),x=Object(s.useCallback)((function(e){return"external"===e.type?n.formatMessage({id:"content__external_account"}):"imported"===e.type?n.formatMessage({id:"wallet__imported_accounts"}):"watching"===e.type?n.formatMessage({id:"wallet__watched_accounts"}):e.name}),[n]);return Object(C.jsx)(E.default,{stickySectionHeadersEnabled:!1,sections:h,contentContainerStyle:{flexGrow:1},keyExtractor:function(e,t){return""+e.address+t},renderItem:function(e){var t=e.item,a=e.section,n=e.index;return Object(C.jsxs)(U.default,{flexDirection:"row",p:"4",bg:"surface-default",mx:{base:4,md:6},borderTopLeftRadius:0===n?"12":void 0,borderTopRightRadius:0===n?"12":void 0,borderBottomLeftRadius:n===a.data.length-1?"12":void 0,borderBottomRightRadius:n===a.data.length-1?"12":void 0,onPress:function(){return _({address:t.address,name:t.name})},alignItems:"center",children:[Object(C.jsx)(j.default,{mr:"3",children:Object(C.jsx)(X.default,{avatar:a.wallet.avatar,walletImage:a.wallet.type,hwWalletType:a.wallet.deviceType||Object(K.getDeviceTypeByDeviceId)(a.wallet.associatedDevice),isPassphrase:Object(Q.isPassphraseWallet)(a.wallet),size:"sm"})},t.address),Object(C.jsxs)(j.default,{flex:"1",children:[Object(C.jsx)(z.default.Body1Strong,{color:"text-default",numberOfLines:1,children:t.name}),Object(C.jsx)(z.default.Body2,{color:"text-subdued",children:Object(G.shortenAddress)(t.address)})]})]})},ItemSeparatorComponent:Z,renderSectionHeader:function(e){var t=e.section;return Object(C.jsx)(z.default.Subheading,{my:"2",mx:{base:4,md:6},children:x(t.wallet)})}})},te=function(){var e,t=Object(o.default)(),a=null!=(e=Object(d.useRoute)().params)?e:{},n=a.addressFilter,r=a.contactExcludeWalletAccount,c=Object(s.useState)(0),i=W()(c,2),u=i[0],l=i[1],f=Object(d.useNavigation)(),m=Object(s.useCallback)((function(){f.navigate(Y.AddressBookRoutes.NewAddressRoute)}),[f]),O=Object(s.useMemo)((function(){return Object(C.jsx)(ee,{addressFilter:n})}),[n]),p=Object(s.useMemo)((function(){return Object(C.jsx)($,{addressFilter:n})}),[n]);return Object(C.jsxs)(b.default,{header:t.formatMessage({id:"title__select_contact"}),hideSecondaryAction:!0,footer:0===u?void 0:null,primaryActionTranslationId:"action__add_new_address",primaryActionProps:{leftIconName:"PlusMini",type:"basic",onPress:m},maxHeight:"560px",hidePrimaryAction:0!==u,staticChildrenProps:{flex:1,py:6},children:[Object(C.jsx)(j.default,{mb:"6",px:{base:4,md:6},children:r?null:Object(C.jsx)(N.default,{values:[t.formatMessage({id:"title__address_book"}),t.formatMessage({id:"form__my_wallet"})],selectedIndex:u,onChange:l})}),Object(C.jsx)(j.default,{flex:"1",children:0===u?p:O})]})},ae=a(238),ne=Object(ae.default)(),re=[{name:Y.AddressBookRoutes.NewAddressRoute,component:B},{name:Y.AddressBookRoutes.PickAddressRoute,component:te},{name:Y.AddressBookRoutes.EditAddressRoute,component:S},{name:Y.AddressBookRoutes.EnterAddressRoute,component:I},{name:Y.AddressBookRoutes.NewPickAddressRoute,component:R.default}];t.default=function(){var e=Object(n.default)();return Object(C.jsx)(ne.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:re.map((function(e){return Object(C.jsx)(ne.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);