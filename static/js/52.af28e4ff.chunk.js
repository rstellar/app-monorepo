(this.webpackJsonp=this.webpackJsonp||[]).push([[52],{3993:function(e,t,n){"use strict";n.r(t);var r=n(4118);n.d(t,"default",(function(){return r.Hidden}))},4042:function(e,t,n){e.exports=n.p+"static/media/lido_pool.3f0c026b.png"},4043:function(e,t,n){"use strict";n.r(t),n.d(t,"StakingTypes",(function(){return o})),n.d(t,"coingeckoId2StakingTypes",(function(){return p})),n.d(t,"getStakeSelectNetworkAccountFilter",(function(){return b})),n.d(t,"isAccountCompatibleWithStakingTypes",(function(){return h})),n.d(t,"isSupportStakingType",(function(){return g})),n.d(t,"getLidoTokenEvmAddress",(function(){return O})),n.d(t,"isSTETH",(function(){return v})),n.d(t,"fetchStEthRate",(function(){return y})),n.d(t,"buildWithdrawStEthTransaction",(function(){return w}));var r,o,a=n(2),i=n.n(a),s=n(113),c=n(35),d=n(17),u=n(4045),l=n(566),f=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],m=[];!function(e){e.eth="eth",e.matic="matic"}(o||(o={}));var p={ethereum:o.eth},j=((r={})[o.eth]=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],r[o.matic]=[c.OnekeyNetwork.eth,c.OnekeyNetwork.goerli],r),b=function(e){var t=j[e];if(t&&0!==t.length)return function(e){var n=e.network;return!!n&&t.includes(n.id)}},h=function(e,t){var n=j[t];return!(!n||0===n.length)&&n.some((function(t){return Object(s.isAccountCompatibleWithNetwork)(e,t)}))},g=function(e){var t=function(e){var t=e.tokenIdOnNetwork,n=e.networkId;return n?t?n+"--"+t:""+n:""}({networkId:e.networkId,tokenIdOnNetwork:e.tokenIdOnNetwork});return f.includes(t)?o.eth:m.includes(t)?o.matic:void 0},O=function(e,t){if(e)return e!==c.OnekeyNetwork.goerli||t?e!==c.OnekeyNetwork.eth||t?void 0:l.MainnetLidoContractAddress:l.TestnetLidoContractAddress},v=function(e,t){return!(!e||!t)&&(e===c.OnekeyNetwork.goerli&&t.toLowerCase()===l.TestnetLidoContractAddress.toLowerCase()||e===c.OnekeyNetwork.eth&&t.toLowerCase()===l.MainnetLidoContractAddress.toLowerCase())};function y(e){return k.apply(this,arguments)}function k(){return(k=i()((function*(e){var t=e.networkId,n=e.account,r=e.amount||"0.1",o=yield d.default.engine.getNativeTokenInfo(t),a=yield d.default.serviceStaking.getStEthToken({networkId:t}),i=yield d.default.engine.getNetwork(t),s={networkOut:i,networkIn:i,tokenOut:o,tokenIn:a,slippagePercentage:"1",typedValue:r,independentField:"INPUT",activeAccount:n,receivingAddress:n.address};return yield u.SwapQuoter.client.fetchQuote(s)}))).apply(this,arguments)}function w(e){return x.apply(this,arguments)}function x(){return(x=i()((function*(e){var t=e.networkId,n=e.account,r=e.typedValue,o=yield d.default.engine.getNativeTokenInfo(t),a=yield d.default.serviceStaking.getStEthToken({networkId:t}),i=yield d.default.engine.getNetwork(t),s={networkOut:i,networkIn:i,tokenOut:o,tokenIn:a,slippagePercentage:"1",typedValue:r,independentField:"INPUT",activeAccount:n,receivingAddress:n.address},c=yield u.SwapQuoter.client.fetchQuote(s),l=null==c?void 0:c.data;if(!l)throw new Error("failed to build unstake params");return{params:s,quote:l}}))).apply(this,arguments)}},4045:function(e,t,n){"use strict";n.r(t),n.d(t,"SwapQuoter",(function(){return q}));var r=n(3),o=n.n(r),a=n(2),i=n.n(a),s=n(6),c=n.n(s),d=n(88),u=n.n(d),l=n(21),f=n.n(l),m=n(62),p=n(52),j=n(12),b=n(18),h=n(17),g=n(173),O=n(35),v=n(582),y=n(964);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(){function e(){this.type=y.QuoterType.zeroX,this.client=u.a.create({timeout:1e4})}var t=e.prototype;return t.getBaseUrl=function(){var e=i()((function*(e){var t,n=yield h.default.serviceSwap.getServerEndPoint();return((t={})[O.OnekeyNetwork.eth]=n+"/0x/quote?chainID=ethereum",t[O.OnekeyNetwork.bsc]=n+"/0x/quote?chainID=bsc",t[O.OnekeyNetwork.polygon]=n+"/0x/quote?chainID=polygon",t[O.OnekeyNetwork.fantom]=n+"/0x/quote?chainID=fantom",t[O.OnekeyNetwork.avalanche]=n+"/0x/quote?chainID=avalanche",t[O.OnekeyNetwork.celo]=n+"/0x/quote?chainID=celo",t[O.OnekeyNetwork.optimism]=n+"/0x/quote?chainID=optimism",t[O.OnekeyNetwork.arbitrum]=n+"/0x/quote?chainID=arbitrum",t)[e]}));return function(t){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){return e.id===t.id&&v.zeroXenabledNetworkIds.includes(e.id)},t.getProviderLogo=function(e){return"https://common.onekey-asset.com/logo/"+e+".png"},t.fetch0xQuote=function(){var e=i()((function*(e,t){var n=this,r=(yield this.client.get(e,{params:t})).data.data;return{providers:(null==r?void 0:r.sources.filter((function(e){return Number(e.proportion)>0}))).map((function(e){return{name:e.name.split("_").join(" "),logoUrl:n.getProviderLogo(e.name)}})),data:r}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){var t,n=e.networkIn,r=e.networkOut,o=e.tokenIn,a=e.tokenOut,i=e.slippagePercentage,s=e.independentField,c=e.typedValue,d=e.activeAccount,u=e.receivingAddress;if(this.isSupported(n,r)&&u===d.address){var l=+i/100,f={sellToken:o.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:a.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress};"INPUT"===s?f.sellAmount=new g.TokenAmount(o,c).toFormat():f.buyAmount=new g.TokenAmount(a,c).toFormat();var m=yield this.getBaseUrl(o.networkId);if(m){var p=yield this.fetch0xQuote(m,f),j=p.providers,b=p.data,h={type:this.type,instantRate:b.price,allowanceTarget:b.allowanceTarget,buyAmount:b.buyAmount,buyTokenAddress:b.buyTokenAddress,sellAmount:b.sellAmount,sellTokenAddress:b.sellTokenAddress,arrivalTime:null!=(t=v.estimatedTime[n.id])?t:30,percentageFee:b.percentageFee,providers:j};return b.data&&(h.txData={from:d.address,to:b.to,data:b.data,value:b.value}),h.instantRate="INPUT"===s?b.price:Object(g.div)(1,b.price),{data:h}}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenIn,o=e.tokenOut,a=e.slippagePercentage,i=e.independentField,s=e.typedValue,c=e.activeAccount,d=e.txData,u=e.receivingAddress;if(this.isSupported(t,n)&&u===c.address){if(d)return{data:d};var l=+a/100,f={sellToken:r.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:o.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress,takerAddress:c.address};"INPUT"===i?f.sellAmount=new g.TokenAmount(r,s).toFormat():f.buyAmount=new g.TokenAmount(o,s).toFormat();var m=yield this.getBaseUrl(r.networkId);if(m)return{data:w(w({},(yield this.fetch0xQuote(m,f)).data),{},{from:c.address})}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>864e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e){return e.tokenIdOnNetwork?e.tokenIdOnNetwork:"So11111111111111111111111111111111111111112"}var S=function(){function e(){this.type=y.QuoterType.jupiter,this.client=u.a.create({timeout:6e4})}var t=e.prototype;return t.getBaseURL=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/jupiter"}));return function(){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){return e.id===t.id&&"sol"===e.impl},t.fetchPrice=function(){var e=i()((function*(e,t){var n=(yield this.getBaseURL())+"/v1/price",r=yield this.client.get(n,{params:{id:T(e),vsToken:T(t)}});if(r.data)return r.data.data}));return function(t,n){return e.apply(this,arguments)}}(),t.buildSwapTransaction=function(){var e=i()((function*(e,t,n){var r=(yield this.getBaseURL())+"/v1/swap",o=(yield this.client.post(r,{route:e,userPublicKey:t,outputMint:n})).data;if(!(null!=o&&o.cleanupTransaction||null!=o&&o.setupTransaction))return null==o?void 0:o.swapTransaction}));return function(t,n,r){return e.apply(this,arguments)}}(),t.findBestTransaction=function(){var e=i()((function*(e,t,n){for(var r=0;r<e.length;r+=1){var o=e[r],a=yield this.buildSwapTransaction(o,t,n);if(a)return{transaction:a,route:o}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.doQuote=function(){var e=i()((function*(e,t){var n,r=(yield this.getBaseURL())+"/v1/quote",o=yield this.client.get(r,{params:e});if(o.data){var a=o.data.data,i=yield this.findBestTransaction(a,t,e.outputMint);if(i)return _(_({},i),{},{percentageFee:null==o||null==(n=o.data)?void 0:n.percentageFee})}}));return function(t,n){return e.apply(this,arguments)}}(),t.refreshRecentBlockBash=function(){var e=i()((function*(e,t){return h.default.engine.solanaRefreshRecentBlockBash({transaction:t,accountId:e,networkId:O.OnekeyNetwork.sol})}));return function(t,n){return e.apply(this,arguments)}}(),t.findRouteAndTransaction=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=e.independentField,a=e.activeAccount,i={inputMint:T(t),outputMint:T(n),amount:Object(g.getTokenAmountString)("OUTPUT"===o?n:t,r),swapMode:"ExactIn",slippage:e.slippagePercentage,onlyDirectRoutes:!0};"OUTPUT"===o&&(i.swapMode="ExactOut");var s=yield this.doQuote(i,a.address);return s||(i.onlyDirectRoutes=!1,yield this.doQuote(i,a.address))}));return function(t){return e.apply(this,arguments)}}(),t.fetchRawQuote=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=yield this.findRouteAndTransaction(e);if(r){var o=r.route,a=r.transaction,i=r.percentageFee;if(o)return{data:{type:this.type,instantRate:Object(g.calculateRate)(t.decimals,n.decimals,o.inAmount,o.outAmount),sellTokenAddress:T(t),buyTokenAddress:T(n),providers:[{name:"Jupiter",logoUrl:"https://common.onekey-asset.com/logo/Jupiter.png"}],arrivalTime:30,sellAmount:String(o.inAmount),buyAmount:String(o.outAmount),percentageFee:i,txData:a}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchAdjustedQuote=function(){var e=i()((function*(e){var t=e.tokenIn,n=e.tokenOut,r=e.typedValue;if("OUTPUT"===e.independentField){var o=yield this.fetchPrice(t,n);if(o){var a=Object(g.div)(r,o.price),i=_({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.findRouteAndTransaction(i);if(s){var c=s.route,d=s.transaction,u=new f.a(Object(g.getTokenAmountString)(n,r)),l=new f.a(c.outAmount).isGreaterThan(u.multipliedBy(.95));if(c&&l)return{data:{type:this.type,instantRate:Object(g.calculateRate)(t.decimals,n.decimals,c.inAmount,c.outAmount),sellTokenAddress:T(t),buyTokenAddress:T(n),providers:[{name:"Jupiter",logoUrl:"https://common.onekey-asset.com/logo/Jupiter.png"}],arrivalTime:30,sellAmount:String(c.inAmount),buyAmount:String(Object(g.getTokenAmountString)(n,r)),txData:d}}}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){if(e.activeAccount.address===e.receivingAddress){var t=yield this.fetchRawQuote(e);return t||this.fetchAdjustedQuote(e)}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){if(e.activeAccount.address===e.receivingAddress){var t=e.activeAccount;if(e.txData)if("string"===typeof e.txData)return{data:yield this.refreshRecentBlockBash(t.id,e.txData)};var n=yield this.findRouteAndTransaction(e);if(n){var r=n.transaction;return{data:yield this.refreshRecentBlockBash(r,t.id)}}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.hash;return{status:yield h.default.serviceHistory.queryTransactionByTxid({networkId:t,accountId:n,txid:r})}}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M=function(){function e(){this.type=y.QuoterType.mdex,this.client=u.a.create({timeout:1e4})}var t=e.prototype;return t.isSupported=function(e,t){return e.id===t.id&&!!v.quoterServerEndpoints[e.id]},t.fetchQuote=function(){var e=i()((function*(e){var t,n=e.networkIn,r=e.networkOut,o=e.tokenIn,a=e.tokenOut,i=e.slippagePercentage,s=e.independentField,c=e.typedValue,d=e.activeAccount,u=e.receivingAddress;if(this.isSupported(n,r)&&u===d.address){var l=+i/100,f={sellToken:o.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:a.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress};"INPUT"===s?f.sellAmount=new g.TokenAmount(o,c).toFormat():f.buyAmount=new g.TokenAmount(a,c).toFormat();var m=v.quoterServerEndpoints[o.networkId];if(m){var p=(yield this.client.get(m,{params:f})).data,j={type:this.type,instantRate:p.price,allowanceTarget:p.allowanceTarget,buyAmount:p.buyAmount,buyTokenAddress:p.buyTokenAddress,sellAmount:p.sellAmount,sellTokenAddress:p.sellTokenAddress,providers:null!=(t=v.networkProviderInfos[o.networkId])?t:[{name:"OneKey Swap"}],arrivalTime:15};return p.data&&(j.txData={from:d.address,to:p.to,data:p.data,value:p.value}),j.instantRate="INPUT"===s?p.price:Object(g.div)(1,p.price),{data:j}}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenIn,o=e.tokenOut,a=e.slippagePercentage,i=e.independentField,s=e.typedValue,c=e.activeAccount,d=e.txData,u=e.receivingAddress;if(this.isSupported(t,n)&&u===c.address){if(d)return{data:d};var l=+a/100,f={sellToken:r.tokenIdOnNetwork||g.nativeTokenAddress,buyToken:o.tokenIdOnNetwork||g.nativeTokenAddress,slippagePercentage:Number.isNaN(l)?"0.03":String(l),feeRecipient:g.feeRecipient,affiliateAddress:g.affiliateAddress,takerAddress:c.address};"INPUT"===i?f.sellAmount=new g.TokenAmount(r,s).toFormat():f.buyAmount=new g.TokenAmount(o,s).toFormat();var m=v.quoterServerEndpoints[r.networkId];if(m)return{data:R(R({},(yield this.client.get(m,{params:f})).data),{},{from:c.address})}}}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>36e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),c()(e)}();function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,B=function(){function e(){this.type=y.QuoterType.socket,this.client=u.a.create({timeout:3e4})}var t=e.prototype;return t.prepare=function(){this.refreshSupportedChains()},t.getBaseURL=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/socketBridge"}));return function(){return e.apply(this,arguments)}}(),t.fetchTokenPrice=function(){var e=i()((function*(e){var t,n=(yield this.getBaseURL())+"/token-price",r=yield this.client.get(n,{params:{tokenAddress:Object(g.getEvmTokenAddress)(e),chainId:Object(g.getChainIdFromNetworkId)(e.networkId)}});return null==r||null==(t=r.data)?void 0:t.result}));return function(t){return e.apply(this,arguments)}}(),t.fetchInstantTokenRate=function(){var e=i()((function*(e,t){var n=yield this.fetchTokenPrice(e),r=yield this.fetchTokenPrice(t);if(n&&r)return new f.a(r.tokenPrice).div(n.tokenPrice).toNumber()}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchInstantTokenRateFromChain=function(){var e=i()((function*(e,t,n){var r,o,a,i,s=(yield this.getBaseURL())+"/quote",c={fromChainId:Object(g.getChainIdFromNetworkId)(e.networkId),fromTokenAddress:Object(g.getEvmTokenAddress)(e),toChainId:Object(g.getChainIdFromNetworkId)(t.networkId),toTokenAddress:Object(g.getEvmTokenAddress)(t),fromAmount:Object(g.getTokenAmountString)(e,"1"),userAddress:n,sort:"output",singleTxOnly:!0},d=yield this.client.get(s,{params:c}),u=null==(r=d)||null==(o=r.data)?void 0:o.result;if(u){if(u.routes.length>0){var l=u.routes[0],f=Object(g.calculateRate)(e.decimals,t.decimals,l.fromAmount,l.toAmount);return Number(f)}if(u.bridgeRouteErrors){var m=Object.values(u.bridgeRouteErrors).find((function(e){return e.maxAmount||e.minAmount}));if(m){var p=(null==m?void 0:m.maxAmount)||(null==m?void 0:m.minAmount);if(p&&(c.fromAmount=p,(u=null==(a=d=yield this.client.get(s,{params:c}))||null==(i=a.data)?void 0:i.result)&&u.routes.length>0)){var j=u.routes[0],b=Object(g.calculateRate)(e.decimals,t.decimals,j.fromAmount,j.toAmount);return Number(b)}}}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.refreshSupportedChains=function(){var e=i()((function*(){var e=yield this.fetchSupportedChains(),t=e.filter((function(e){return e.sendingEnabled})).map((function(e){return String(e.chainId)})),n=e.filter((function(e){return e.receivingEnabled})).map((function(e){return String(e.chainId)}));t.length>0&&(this.supportedSendingChainIds=t),n.length>0&&(this.supportedReceivingChainIds=n)}));return function(){return e.apply(this,arguments)}}(),t.fetchSupportedChains=function(){var e=i()((function*(){var e,t=yield this.getBaseURL(),n=yield this.client.get(t+"/supported/chains");return null==n||null==(e=n.data)?void 0:e.result}));return function(){return e.apply(this,arguments)}}(),t.getBridgeInfo=function(){var e=i()((function*(e){this.supportedBridges||(this.supportedBridges=yield this.fetchSupportedBridges());var t=this.supportedBridges.filter((function(t){return t.name===e||t.bridgeName===e}))[0];return{icon:null==t?void 0:t.icon,displayName:null==t?void 0:t.displayName}}));return function(t){return e.apply(this,arguments)}}(),t.fetchSupportedBridges=function(){var e=i()((function*(){var e,t=yield this.getBaseURL(),n=yield this.client.get(t+"/supported/bridges");return null==n||null==(e=n.data)?void 0:e.result}));return function(){return e.apply(this,arguments)}}(),t.isSupported=function(e,t){var n="evm"===e.impl&&"evm"===t.impl;if(!n)return!1;if(!this.supportedReceivingChainIds||!this.supportedSendingChainIds)return n;var r=Object(g.getChainIdFromNetwork)(e),o=Object(g.getChainIdFromNetwork)(t);return n&&this.supportedSendingChainIds.includes(r)&&this.supportedReceivingChainIds.includes(o)},t.fetchTransactionData=function(){var e=i()((function*(e){var t=yield this.getBaseURL();return(yield this.client.post(t+"/build-tx",{route:e})).data.result}));return function(t){return e.apply(this,arguments)}}(),t.fetchSimpleQuoteFromInput=function(){var e=i()((function*(e){var t,n,r=(yield this.getBaseURL())+"/quote";if(e.networkIn.id===e.networkOut.id&&"OUTPUT"!==e.independentField){var o;try{o=yield this.client.get(r,{params:{fromChainId:Object(g.getChainIdFromNetworkId)(e.networkIn.id),fromTokenAddress:Object(g.getEvmTokenAddress)(e.tokenIn),toChainId:Object(g.getChainIdFromNetworkId)(e.networkOut.id),toTokenAddress:Object(g.getEvmTokenAddress)(e.tokenOut),fromAmount:Object(g.getTokenAmountString)(e.tokenIn,e.typedValue),userAddress:e.activeAccount.address,recipient:e.receivingAddress,sort:"output",singleTxOnly:!0}})}catch(b){return}var a=null==(t=o)||null==(n=t.data)?void 0:n.result;if(a&&a.routes.length>0){var i=a.routes.find((function(e){return!!e.isOnlySwapRoute}));if(i){var s,c,d=i.fromAmount,u=Object(g.getEvmTokenAddress)(e.tokenIn),l=i.toAmount,f=Object(g.getEvmTokenAddress)(e.tokenOut),m=Object(g.calculateRate)(e.tokenIn.decimals,e.tokenOut.decimals,d,l),p=yield this.fetchTransactionData(i);p&&p.approvalData&&p.approvalData.allowanceTarget&&(s=p.approvalData.allowanceTarget),p&&(c={from:e.activeAccount.address,value:p.value,to:p.txTarget,data:p.txData});var j=[];if(i.userTxs)j=i.userTxs.filter((function(e){return e.protocol})).map((function(e){return e.protocol})).map((function(e){return{name:e.displayName,logoUrl:e.icon}}));return{data:{type:this.type,sellAmount:d,sellTokenAddress:u,buyAmount:l,buyTokenAddress:f,instantRate:m,allowanceTarget:s,txData:c,arrivalTime:30,providers:j}}}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchSimpleQuote=function(){var e=i()((function*(e){if("INPUT"===e.independentField)return this.fetchSimpleQuoteFromInput(e);var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=yield this.fetchInstantTokenRateFromChain(t,n,e.activeAccount.address);if(o){var a=Object(g.div)(r,o),i=N({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.fetchSimpleQuoteFromInput(i);if(null==s||!s.data)return s;var c=new f.a(s.data.buyAmount),d=new f.a(Object(g.getTokenAmountString)(n,r));if(c.isGreaterThan(d.multipliedBy(.95))){var u=s.data;return u.buyAmount=Object(g.getTokenAmountString)(n,r),{data:u}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchMultichainQuoteFromInput=function(){var e=i()((function*(e){var t,n,r=this,o=(yield this.getBaseURL())+"/quote";if("OUTPUT"!==e.independentField){var a;try{a=yield this.client.get(o,{params:{fromChainId:Object(g.getChainIdFromNetworkId)(e.networkIn.id),fromTokenAddress:Object(g.getEvmTokenAddress)(e.tokenIn),toChainId:Object(g.getChainIdFromNetworkId)(e.networkOut.id),toTokenAddress:Object(g.getEvmTokenAddress)(e.tokenOut),fromAmount:Object(g.getTokenAmountString)(e.tokenIn,e.typedValue),userAddress:e.activeAccount.address,recipient:e.receivingAddress,sort:"output",singleTxOnly:!0}})}catch(y){return}var i=null==(t=a)||null==(n=t.data)?void 0:n.result;if(i&&i.routes.length>0){var s,c,d=i.routes[0],u=d.fromAmount,l=Object(g.getEvmTokenAddress)(e.tokenIn),f=d.toAmount,m=Object(g.getEvmTokenAddress)(e.tokenOut),p=Object(g.calculateRate)(e.tokenIn.decimals,e.tokenOut.decimals,u,f),j=yield this.fetchTransactionData(d);j&&j.approvalData&&j.approvalData.allowanceTarget&&(s=j.approvalData.allowanceTarget),j&&(c={from:e.activeAccount.address,value:j.value,to:j.txTarget,data:j.txData});var b=yield Promise.all(d.usedBridgeNames.map((function(e){return r.getBridgeInfo(e)}))),h=d.usedBridgeNames.map((function(e,t){var n,r;return{name:null==(n=b[t])?void 0:n.displayName,logoUrl:null==(r=b[t])?void 0:r.icon}}));return{data:{type:this.type,sellAmount:u,sellTokenAddress:l,buyAmount:f,buyTokenAddress:m,instantRate:p,allowanceTarget:s,txData:c,arrivalTime:d.serviceTime,providers:h,additionalParams:{socketUsedBridgeNames:d.usedBridgeNames}}}}var O=null==i?void 0:i.bridgeRouteErrors;if(O){var v=Object.values(O).filter((function(e){return e.maxAmount||e.minAmount})).map((function(e){return{max:e.maxAmount,min:e.minAmount}}));if(v.length>0)return{limited:Object(g.calculateRange)(v)}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchMultichainQuote=function(){var e=i()((function*(e){if("INPUT"===e.independentField)return this.fetchMultichainQuoteFromInput(e);var t=e.tokenIn,n=e.tokenOut,r=e.typedValue,o=yield this.fetchInstantTokenRateFromChain(t,n,e.activeAccount.address);if(o){var a=Object(g.div)(r,o),i=N({},e);i.independentField="INPUT",i.typedValue=a;var s=yield this.fetchMultichainQuoteFromInput(i);if(null==s||!s.data)return s;var c=new f.a(s.data.buyAmount),d=new f.a(Object(g.getTokenAmountString)(n,r));if(c.isGreaterThan(d.multipliedBy(.95))){var u=s.data;return u.buyAmount=Object(g.getTokenAmountString)(n,r),{data:u}}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){if(this.isSupported(e.networkIn,e.networkOut))return e.networkIn.id===e.networkOut.id?this.fetchSimpleQuote(e):this.fetchMultichainQuote(e)}));return function(t){return e.apply(this,arguments)}}(),t.buildTransaction=function(){var e=i()((function*(e){var t=e.txData,n=e.additionalParams;if(t)return{data:t,attachment:{socketUsedBridgeNames:null==n?void 0:n.socketUsedBridgeNames}};var r,o,a=yield this.fetchQuote(e);if(null!=a&&a.data&&(null!=a&&null!=(r=a.data)&&r.txData))return{data:null==a?void 0:a.data.txData,attachment:{socketUsedBridgeNames:null==(o=a.data.additionalParams)?void 0:o.socketUsedBridgeNames}}}));return function(t){return e.apply(this,arguments)}}(),t.querySocketBridgeStatus=function(){var e=i()((function*(e){var t,n;try{var r=yield this.getBaseURL();n=yield this.client.get(r+"/bridge-status",{params:e})}catch(i){return}var o,a=n.data.result;return"COMPLETED"===a.sourceTxStatus&&"COMPLETED"===a.destinationTxStatus||"COMPLETED"===(null==(t=a.refuel)?void 0:t.status)?{status:"sucesss",destinationTransactionHash:a.destinationTransactionHash||(null==(o=a.refuel)?void 0:o.destinationTransactionHash)}:"FAILED"===a.destinationTxStatus||"FAILED"===a.sourceTxStatus?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),t.queryCrosschainTransactionProgress=function(){var e=i()((function*(e){var t=e.nonce,n=e.networkId,r=e.accountId,o=e.tokens,a=e.attachment;if(void 0!==t&&o)for(var i=o.from,s=o.to,c=Object(g.getChainIdFromNetworkId)(i.networkId),d=Object(g.getChainIdFromNetworkId)(s.networkId),u=yield h.default.serviceHistory.getTransactionsWithNonce({nonce:t,networkId:n,accountId:r}),l=0;l<u.length;l+=1){var f,m=u[l].decodedTx.txid,p=yield this.querySocketBridgeStatus({fromChainId:c,toChainId:d,transactionHash:m,bridgeName:null==a||null==(f=a.socketUsedBridgeNames)?void 0:f[0]});if("sucesss"===(null==p?void 0:p.status))return{status:p.status,destinationTransactionHash:p.destinationTransactionHash};if("failed"===(null==p?void 0:p.status))return{status:p.status};if(null!=p&&p.destinationTransactionHash)return{destinationTransactionHash:p.destinationTransactionHash}}if(Date.now()-e.addedTime>864e5)return{status:"failed"}}));return function(t){return e.apply(this,arguments)}}(),t.querySimpleTransactionProgress=function(){var e=i()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})};var o=yield h.default.serviceNetwork.rpcCall(t,{method:"eth_getTransactionReceipt",params:[e.hash]});return o?{status:1===Number(o.status)?"sucesss":"failed"}:Date.now()-e.addedTime>864e5?{status:"failed"}:void 0}));return function(t){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){var t=e.tokens;if(t){var n=t.from,r=t.to;return n.networkId===r.networkId?this.querySimpleTransactionProgress(e):this.queryCrosschainTransactionProgress(e)}}));return function(t){return e.apply(this,arguments)}}(),c()(e)}(),D=((P={})[O.OnekeyNetwork.btc]="BTC",P[O.OnekeyNetwork.eth]="ETH",P[O.OnekeyNetwork.bsc]="BSC",P[O.OnekeyNetwork.heco]="HECO",P[O.OnekeyNetwork.polygon]="POLYGON",P[O.OnekeyNetwork.avalanche]="AVAXC",P[O.OnekeyNetwork.okt]="OKExChain",P[O.OnekeyNetwork.fantom]="FTM",P[O.OnekeyNetwork.arbitrum]="ARB",P[O.OnekeyNetwork.celo]="CELO",P[O.OnekeyNetwork.optimism]="Optimism",P[O.OnekeyNetwork.sol]="SOL",P[O.OnekeyNetwork.trx]="TRX",P[O.OnekeyNetwork.near]="NEAR",P[O.OnekeyNetwork.etc]="ETC",P[O.OnekeyNetwork.ethw]="ETHW",P[O.OnekeyNetwork.etf]="ETHF",P[O.OnekeyNetwork.doge]="DOGE",P[O.OnekeyNetwork.ltc]="LTC",P[O.OnekeyNetwork.bch]="BCH",P[O.OnekeyNetwork.apt]="APT",P[O.OnekeyNetwork.algo]="ALGO",P),E={};function F(e){var t;return null!=(t=D[e.id])?t:""}var L=function(){var e=t.prototype;function t(){this.type=y.QuoterType.swftc,this.coinsLastUpdate=0,this.coinCodeRecords={},this.coinCodeRecordsLastUpdate=0,this.networkAddrRecords={},this.networkAddrRecordsLastUpdate=0,this.client=u.a.create({timeout:6e4})}return e.getBaseUrl=function(){var e=i()((function*(){return(yield h.default.serviceSwap.getServerEndPoint())+"/swft"}));return function(){return e.apply(this,arguments)}}(),e.prepare=function(){this.getCoins()},e.isSupported=function(e,t){return!0},e.modifyTxId=function(){var e=i()((function*(e,t){var n=(yield this.getBaseUrl())+"/modifyTxId";return(yield this.client.post(n,{orderId:e,depositTxid:t})).data.data}));return function(t,n){return e.apply(this,arguments)}}(),e.getGroupedCoins=function(){var e=i()((function*(){var e=yield this.getCoins();return this.groupCoinsByChainId(e)}));return function(){return e.apply(this,arguments)}}(),e.getCoin=function(){var e=i()((function*(e,t){var n,r=F(e);return null==(n=(yield this.getNetworkAddrRecords())[r])?void 0:n[t]}));return function(t,n){return e.apply(this,arguments)}}(),e.getLocalCoins=function(){var e=i()((function*(){var e=h.default.serviceSwap;return this.coins?this.coins:yield e.getSwftcCoins()}));return function(){return e.apply(this,arguments)}}(),e.saveLocalCoins=function(){var e=i()((function*(e){var t=h.default.serviceSwap;yield t.setSwftcCoins(e),this.coins=e,this.coinsLastUpdate=Date.now()}));return function(t){return e.apply(this,arguments)}}(),e.getRemoteCoins=function(){var e=i()((function*(){var e=(yield this.getBaseUrl())+"/queryCoinList";return(yield this.client.post(e)).data.data}));return function(){return e.apply(this,arguments)}}(),e.updateCoins=function(){var e=i()((function*(){var e=yield this.getRemoteCoins();this.saveLocalCoins(e)}));return function(){return e.apply(this,arguments)}}(),e.getCoins=function(){var e=i()((function*(){var e=this,t=yield this.getLocalCoins();return t||(t=yield this.getRemoteCoins(),yield this.saveLocalCoins(t)),Date.now()-this.coinsLastUpdate>36e5&&setTimeout((function(){return e.updateCoins()}),10),t}));return function(){return e.apply(this,arguments)}}(),e.getNetworkAddrRecords=function(){var e=i()((function*(){if(this.networkAddrRecords&&Date.now()-this.networkAddrRecordsLastUpdate<36e5)return this.networkAddrRecords;var e=yield this.getCoins(),t={};return e.forEach((function(e){t[e.mainNetwork]||(t[e.mainNetwork]={});var n=e.contact||g.nativeTokenAddress;t[e.mainNetwork][n]=e})),this.networkAddrRecords=t,this.networkAddrRecordsLastUpdate=Date.now(),this.networkAddrRecords}));return function(){return e.apply(this,arguments)}}(),e.groupCoinsByChainId=function(e){var t={};return e.forEach((function(e){var n=function(e){if(E[e])return E[e];for(var t=Object.keys(D),n=0;n<t.length;n+=1){var r=t[n],o=D[r];if(o&&(E[o]=r,o===e))return r}}(e.mainNetwork);if(n){t[n]||(t[n]=[]);var r=e.contact||g.nativeTokenAddress;t[n].push(r)}})),t},e.fetchSwftcQuote=function(){var e=i()((function*(e){var t=e.networkIn,n=e.networkOut,r=e.tokenOut,o=e.tokenIn;if(this.isSupported(t,n)){var a=yield this.getNetworkAddrRecords(),i=F(t),s=F(n),c=Object(g.getEvmTokenAddress)(o),d=Object(g.getEvmTokenAddress)(r);if(i&&s){var u,l,f,m,p=null==(u=a[i])||null==(l=u[c])?void 0:l.coinCode,j=null==(f=a[s])||null==(m=f[d])?void 0:m.coinCode,b=(yield this.getBaseUrl())+"/getBaseInfo";if(p&&j)return{depositCoinCode:p,receiveCoinCode:j,rate:(yield this.client.post(b,{depositCoinCode:p,receiveCoinCode:j})).data.data}}}}));return function(t){return e.apply(this,arguments)}}(),e.fetchQuote=function(){var e=i()((function*(e){var t=e.independentField,n=e.tokenIn,r=e.typedValue,o=e.tokenOut,a=yield this.fetchSwftcQuote(e);if(a){var i={type:this.type,instantRate:a.rate.instantRate,sellTokenAddress:Object(g.getEvmTokenAddress)(n),buyTokenAddress:Object(g.getEvmTokenAddress)(o),providers:[{name:"SwftBridge",logoUrl:"https://common.onekey-asset.com/logo/SwftBridge.png"}],arrivalTime:300,sellAmount:"",buyAmount:"",percentageFee:a.rate.percentageFee};"INPUT"===t?(i.sellAmount=Object(g.getTokenAmountString)(n,r),i.buyAmount=Object(g.getTokenAmountString)(o,function(e,t,n,r){var o=new f.a(e),a=new f.a(t),i=new f.a(n),s=new f.a(r);return o.minus(o.multipliedBy(a)).multipliedBy(i).minus(s).toFixed()}(r,Object(g.plus)(a.rate.depositCoinFeeRate,"0"),a.rate.instantRate,a.rate.chainFee))):(i.buyAmount=Object(g.getTokenAmountString)(o,r),i.sellAmount=Object(g.getTokenAmountString)(n,function(e,t,n,r){var o=new f.a(e),a=new f.a(t),i=new f.a(n),s=new f.a(r);return o.plus(s).div(i).div(new f.a(1).minus(a)).toFixed()}(r,Object(g.plus)(a.rate.depositCoinFeeRate,"0"),a.rate.instantRate,a.rate.chainFee)));var s=new g.TokenAmount(n,a.rate.depositMax).toNumber(),c=new g.TokenAmount(n,a.rate.depositMin).toNumber();return{data:i,limited:{max:s.toFixed(),min:c.toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),e.buildTransaction=function(){var e=i()((function*(e){var t=e.typedValue,n=e.independentField,r=e.activeAccount,o=e.tokenIn,a=e.networkIn,i=e.receivingAddress,s=yield this.fetchSwftcQuote(e);if(s&&r){var c=s.depositCoinCode,d=s.receiveCoinCode,u=s.rate,l="",m="";"INPUT"===n?(l=t,m=Object(g.multiply)(t,u.instantRate)):(m=t,l=Object(g.div)(t,u.instantRate));var p=r.address,j=null!=i?i:r.address,b=r.address,O=yield this.createOrder(c,d,new f.a(l).toFixed(8,f.a.ROUND_DOWN),new f.a(m).toFixed(8,f.a.ROUND_DOWN),p,j,b);return O&&O.data?o.tokenIdOnNetwork?{data:yield h.default.engine.buildEncodedTxFromTransfer({networkId:a.id,accountId:r.id,transferInfo:{from:r.address,to:O.data.platformAddr,amount:l,token:o.tokenIdOnNetwork}}),attachment:{swftcOrderId:O.data.orderId}}:{data:yield h.default.engine.buildEncodedTxFromTransfer({networkId:a.id,accountId:r.id,transferInfo:{from:r.address,to:O.data.platformAddr,amount:l}}),attachment:{swftcOrderId:O.data.orderId}}:{error:{code:O.resCode,msg:O.resMsg}}}}));return function(t){return e.apply(this,arguments)}}(),e.createOrder=function(){var e=i()((function*(e,t,n,r,o,a,i){var s={equipmentNo:o,destinationAddr:a,refundAddr:i,depositCoinAmt:n,receiveCoinAmt:r,depositCoinCode:e,receiveCoinCode:t,sourceType:"H5",sourceFlag:"ONEKEY"},c=(yield this.getBaseUrl())+"/accountExchange";return(yield this.client.post(c,s)).data}));return function(t,n,r,o,a,i,s){return e.apply(this,arguments)}}(),e.getTxOrderInfo=function(){var e=i()((function*(e){var t,n,r=null!=(t=null==(n=e.attachment)?void 0:n.swftcOrderId)?t:e.thirdPartyOrderId;if(r){var o=(yield this.getBaseUrl())+"/queryOrderState";return(yield u.a.post(o,{equipmentNo:e.from,sourceType:"H5",orderId:r})).data.data}}));return function(t){return e.apply(this,arguments)}}(),e.queryTransactionProgress=function(){var e=i()((function*(e){var t,n,r=null!=(t=null==(n=e.attachment)?void 0:n.swftcOrderId)?t:e.thirdPartyOrderId;if(r){var o=(yield this.getBaseUrl())+"/queryOrderState",a=(yield u.a.post(o,{equipmentNo:e.from,sourceType:"H5",orderId:r})).data.data;if("complete"===a.tradeState)return{status:"sucesss",destinationTransactionHash:a.transactionId};if(a.transactionId)return{destinationTransactionHash:a.transactionId}}var i=e.networkId,s=e.accountId,c=e.nonce,d=e.hash;if("evm"===Object(m.getNetworkImpl)(i)&&void 0!==c){var l=yield h.default.serviceHistory.queryTransactionNonceStatus({networkId:i,accountId:s,nonce:c});if("canceled"===l||"failed"===l)return{status:l}}else if("evm"!==Object(m.getNetworkImpl)(i)){var f=yield h.default.serviceHistory.queryTransactionByTxid({networkId:i,accountId:s,txid:d});if("canceled"===f||"failed"===f)return{status:f}}if(Date.now()-e.addedTime>864e5)return{status:"failed"}}));return function(t){return e.apply(this,arguments)}}(),c()(t)}();function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(){function e(){this.httpClient=u.a.create({timeout:6e4}),this.jupiter=new S,this.swftc=new L,this.simple=new x,this.socket=new B,this.mdex=new M,this.quoters=[this.mdex,this.simple,this.socket,this.jupiter,this.swftc],this.transactionReceipts={},this.solTransactionReceipts={}}var t=e.prototype;return t.prepare=function(){this.quoters.forEach((function(e){null==e.prepare||e.prepare()}))},t.convertOrderToTransaction=function(){var e=i()((function*(e,t){var n=e.tokenIn,r=e.networkIn,o=e.activeAccount,a=e.sellAmount;if(a&&n){if(!t.platformAddr)throw new Error("failed to build transaction due to invalid platformAddr");var i=new f.a(a).shiftedBy(-n.decimals).toFixed();return n.tokenIdOnNetwork?yield h.default.engine.buildEncodedTxFromTransfer({networkId:r.id,accountId:o.id,transferInfo:{from:o.address,to:t.platformAddr,amount:i,token:n.tokenIdOnNetwork}}):yield h.default.engine.buildEncodedTxFromTransfer({networkId:r.id,accountId:o.id,transferInfo:{from:o.address,to:t.platformAddr,amount:i}})}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchLimitOrderQuote=function(){var e=i()((function*(e){var t,n,r=Object(g.convertLimitOrderParams)(e);if(r){r.quoterType="0x";var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote",a=null==(t=(yield this.httpClient.get(o,{params:r})).data)?void 0:t.data;if(a&&null!=(n=a.result)&&n.instantRate)return{instantRate:Object(g.formatAmountExact)(a.result.instantRate)}}}));return function(t){return e.apply(this,arguments)}}(),t.buildQuote=function(){var e=i()((function*(e){var t=e.responses,n=e.params;if(t&&0!==t.length){var r,o=t.filter((function(e){var t;return null==(t=e.result)?void 0:t.allowanceTarget})).map((function(e){return e.result.allowanceTarget})),a=yield h.default.engine.batchTokensAllowance({networkId:n.tokenIn.networkId,accountId:n.activeAccount.id,tokenIdOnNetwork:n.tokenIn.tokenIdOnNetwork,spenders:o});return a&&a.length===o.length&&o.forEach((function(e,t){var n=a[t];r||(r={}),r[e]=n})),t.map((function(e){var t,n=e.result,o=0;"swft"===n.quoter&&(o=.002);var a,i=o+Number(null!=(t=n.percentageFee)?t:0),s={type:n.quoter,quoterlogo:n.quoterLogo,instantRate:n.instantRate,sellAmount:n.sellAmount,sellTokenAddress:n.sellTokenAddress,buyAmount:n.buyAmount,buyTokenAddress:n.buyTokenAddress,providers:n.sources,percentageFee:n.percentageFee,allowanceTarget:n.allowanceTarget,arrivalTime:n.arrivalTime,needApproved:!1,estimatedBuyAmount:Object(g.multiply)(n.buyAmount,1-i),minAmountOut:n.minAmountOut,protocolFees:n.protocolFees,estimatedPriceImpact:n.estimatedPriceImpact};if(s.allowanceTarget&&r){var c=r[s.allowanceTarget];void 0!==c&&n.sellAmount&&(s.needApproved=Number(n.sellAmount)>c)}return e.limit&&(a={max:e.limit.max,min:e.limit.min}),{data:s,limited:a}}))}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuote=function(){var e=i()((function*(e){var t,n=Object(g.convertParams)(e);if(n){var r=yield h.default.serviceSwap.getCurrentUserSelectedQuoter();r&&(n.quoterType=r);var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote",a=null==(t=(yield this.httpClient.get(o,{params:n})).data)?void 0:t.data;if(a){var i=yield this.buildQuote({responses:[a],params:e});return null==i?void 0:i[0]}}}));return function(t){return e.apply(this,arguments)}}(),t.fetchQuotes=function(){var e=i()((function*(e){var t,n=Object(g.convertParams)(e);if(n){var r=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/quote_all",o=null==(t=(yield this.httpClient.get(r,{params:n})).data)?void 0:t.data;if(o){var a=yield this.buildQuote({responses:o,params:e});if(a)return a.filter((function(e){return Boolean(e)}))}}}));return function(t){return e.apply(this,arguments)}}(),t.parseRequestId=function(e){try{var t=e.config.headers,n=null==t?void 0:t["x-onekey-request-id"];if(!n){var r=null==t?void 0:t["X-Request-By"];if("string"===typeof r)n=JSON.parse(r)["x-onekey-request-id"]}return n}catch(o){b.default.common.error("Failed to get request id with reason",o.message)}},t.buildTransaction=function(){var e=i()((function*(e,t){var n,r=Object(g.convertBuildParams)(t);if(r){r.quoterType=e,r.disableValidate=Boolean(t.disableValidate);var o=(yield h.default.serviceSwap.getServerEndPoint())+"/exchange/build_tx",a=yield this.httpClient.post(o,r),i=this.parseRequestId(a),s=a.data;if(s.errMsg)throw new Error(s.errMsg);if(null!=s&&s.transaction)return"object"===typeof s.transaction?t.networkIn.impl===j.IMPL_APTOS?{data:H(H({},s.transaction),{},{sender:t.activeAccount.address}),result:s.result,requestId:i}:{data:H(H({},s.transaction),{},{from:t.activeAccount.address}),result:s.result,requestId:i}:{data:s.transaction,result:s.result,requestId:i};if(s.order&&null!=(n=s.result)&&n.instantRate)return{data:yield this.convertOrderToTransaction(t,s.order),result:s.result,attachment:{swftcOrderId:s.order.orderId,swftcPlatformAddr:s.order.platformAddr,swftcDepositCoinAmt:s.order.depositCoinAmt,swftcDepositCoinCode:s.order.depositCoinCode,swftcReceiveCoinAmt:s.order.receiveCoinAmt,swftcReceiveCoinCode:s.order.receiveCoinCode},requestId:i}}}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchQuoteLegacy=function(){var e=i()((function*(e){for(var t=0;t<this.quoters.length;t+=1){var n=this.quoters[t];if(n.isSupported(e.networkOut,e.networkIn)){var r=yield n.fetchQuote(e);if(null!=r&&r.data)return r}}}));return function(t){return e.apply(this,arguments)}}(),t.buildTransactionLegacy=function(){var e=i()((function*(e,t){for(var n=0;n<this.quoters.length;n+=1){var r=this.quoters[n];if(r.type===e&&r.isSupported(t.networkOut,t.networkIn)){var o=yield r.buildTransaction(t);if(o)return o}}}));return function(t,n){return e.apply(this,arguments)}}(),t.queryTransactionProgress=function(){var e=i()((function*(e){if(Object(g.isSimpleTx)(e))return this.simple.queryTransactionProgress(e);for(var t=Object(g.getQuoteType)(e),n=0;n<this.quoters.length;n+=1){var r=this.quoters[n];if(r.type===t)return r.queryTransactionProgress(e)}}));return function(t){return e.apply(this,arguments)}}(),t.getHistoryTx=function(){var e=i()((function*(e){var t=h.default.serviceHistory,n=e.accountId,r=e.networkId,o=e.nonce;if(Object(m.getNetworkImpl)(e.networkId)!==j.IMPL_EVM||void 0===o)return(yield t.getLocalHistory({accountId:n,networkId:r})).find((function(t){return t.decodedTx.txid===e.hash}));var a=(yield t.getTransactionsWithNonce({accountId:n,networkId:r,nonce:o})).find((function(e){return e.decodedTx.status===p.IDecodedTxStatus.Confirmed}));return a||void 0}));return function(t){return e.apply(this,arguments)}}(),t.getTransactionReceipt=function(){var e=i()((function*(e,t){var n,r;if(this.transactionReceipts[e]||(this.transactionReceipts[e]={}),null!=(n=this.transactionReceipts[e])&&n[t])return null==(r=this.transactionReceipts[e])?void 0:r[t];var o=yield h.default.serviceNetwork.rpcCall(e,{method:"eth_getTransactionReceipt",params:[t]});return o?(this.transactionReceipts[e][t]=o,o):void 0}));return function(t,n){return e.apply(this,arguments)}}(),t.getSOLTransactionReceipt=function(){var e=i()((function*(e,t){var n,r;if(this.solTransactionReceipts[e]||(this.solTransactionReceipts[e]={}),null!=(n=this.solTransactionReceipts[e])&&n[t])return null==(r=this.solTransactionReceipts[e])?void 0:r[t];var o=yield h.default.serviceNetwork.rpcCall(e,{method:"getTransaction",params:[t,{encoding:"jsonParsed",maxSupportedTransactionVersion:0}]});return o?(this.solTransactionReceipts[e][t]=o,o):void 0}));return function(t,n){return e.apply(this,arguments)}}(),t.doQueryReceivedToken=function(){var e=i()((function*(e,t,n){if(Object(g.isEvmNetworkId)(t.networkId)){var r=yield this.getTransactionReceipt(t.networkId,e);if(r){var o,a=function(e){return"0x"+e.slice(2).replace(/^0+/,"").padStart(40,"0")};if(t.tokenIdOnNetwork){var i,s=null==(i=r.logs)?void 0:i.find((function(e){return a(e.address.toLowerCase())===t.tokenIdOnNetwork.toLowerCase()&&3===e.topics.length&&e.topics[2]&&a(e.topics[2])===n.toLowerCase()}));return null==s?void 0:s.data}var c=null==(o=r.logs)?void 0:o.find((function(e){if(2===e.topics.length){var t=e.topics[0];if("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"===a(t).toLowerCase())return!0}return!1}));return null==c?void 0:c.data}}else if(Object(g.isSolNetworkId)(t.networkId)){var d=yield this.getSOLTransactionReceipt(t.networkId,e);if(d){var u=function(e){var r=t.tokenIdOnNetwork;return e.owner.toLowerCase()===n.toLowerCase()&&e.mint.toLowerCase()===r.toLowerCase()},l=d.meta.preTokenBalances.find(u),f=d.meta.postTokenBalances.find(u);if(l&&f)return Object(g.minus)(f.uiTokenAmount.amount,l.uiTokenAmount.amount)}}}));return function(t,n,r){return e.apply(this,arguments)}}(),t.getActualReceived=function(){var e=i()((function*(e){if(e.tokens){var t=e.receivingAddress,n=e.tokens,r=n.from,o=n.to;if("swftc"===(null==e?void 0:e.quoterType)){var a=yield this.swftc.getTxOrderInfo(e);if(a)return a.receiveCoinAmt}else{var i=yield this.getHistoryTx(e),s=(null==i?void 0:i.decodedTx.txid)||e.hash;if(Object(g.isEvmNetworkId)(r.networkId)&&Object(g.isEvmNetworkId)(o.networkId)&&t){if(s&&r.networkId===o.networkId){var c=yield this.doQueryReceivedToken(s,o.token,t);if(c)return Object(g.getTokenAmountValue)(e.tokens.to.token,c).toFixed()}else if(e.destinationTransactionHash){var d=yield this.doQueryReceivedToken(e.destinationTransactionHash,o.token,t);if(d)return Object(g.getTokenAmountValue)(e.tokens.to.token,d).toFixed()}}else if(Object(g.isSolNetworkId)(r.networkId)&&Object(g.isSolNetworkId)(o.networkId)&&t){var u=yield this.doQueryReceivedToken(e.hash,o.token,t);if(u)return Object(g.getTokenAmountValue)(e.tokens.to.token,u).toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),t.getTxCompletedTime=function(){var e=i()((function*(e){if(e.tokens){var t=e.tokens.to;if(Object(g.isEvmNetworkId)(t.networkId)){var n=e.hash,r=yield this.getHistoryTx(e);null!=r&&r.decodedTx.txid&&(n=null==r?void 0:r.decodedTx.txid),e.destinationTransactionHash&&(n=e.destinationTransactionHash);var o=yield this.getTransactionReceipt(t.networkId,n);if(null!=o&&o.blockHash){var a=yield h.default.serviceNetwork.rpcCall(t.networkId,{method:"eth_getBlockByHash",params:[o.blockHash,!0]});if(null!=a&&a.timestamp)return new f.a(a.timestamp).multipliedBy(1e3).toFixed()}}}}));return function(t){return e.apply(this,arguments)}}(),t.getTxActualNetworkFee=function(){var e=i()((function*(e){if(e.tokens){var t=e.tokens.from;if(Object(g.isEvmNetworkId)(t.networkId)){var n=yield this.getHistoryTx(e),r=(null==n?void 0:n.decodedTx.txid)||e.hash,o=yield this.getTransactionReceipt(t.networkId,r);if(o&&o.gasUsed&&o.effectiveGasPrice){var a=yield h.default.engine.getNetwork(e.networkId);return Object(g.calculateNetworkFee)({limit:o.gasUsed,price:Object(g.div)(o.effectiveGasPrice,10**9)},a)}}}}));return function(t){return e.apply(this,arguments)}}(),t.swftModifyTxId=function(){var e=i()((function*(e,t){return this.swftc.modifyTxId(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),c()(e)}();q.client=new q},4080:function(e,t,n){"use strict";n.r(t),n.d(t,"useSwapSend",(function(){return j})),n.d(t,"useSwapSignMessage",(function(){return b}));var r=n(2),o=n.n(r),a=n(1),i=n(113),s=n(18),c=n(17),d=n(107),u=n(138),l=n(16),f=n(79),m=n(103),p=n(173);function j(){var e=Object(d.default)(),t=Object(u.useAppSelector)((function(e){return e.settings.validationSetting}));return Object(a.useCallback)(function(){var n=o()((function*(n){var r=n.encodedTx,o=n.accountId,a=n.networkId,d=n.payloadInfo,u=n.prepaidFee,j=n.onFail,b=n.onSuccess,h=n.onDetail,g=n.gasEstimateFallback,O=n.showSendFeedbackReceipt,v=Object(p.createLoggerTimer)(),y=Object(i.getWalletIdFromAccountId)(o),k=yield c.default.engine.getWallet(y),w=(yield c.default.servicePassword.getPassword())&&!(null!=t&&t.Payment);if("hw"===k.type||"external"!==k.type&&w)try{v.start(p.LoggerTimerTags.sendTransaction);var x=yield c.default.serviceSwap.sendTransaction({accountId:o,networkId:a,encodedTx:r,payload:d,autoFallback:g,prepaidFee:u}),I=x.result,_=x.decodedTx;v.end(p.LoggerTimerTags.sendTransaction),yield null==b?void 0:b({result:I,decodedTx:_}),O&&setTimeout((function(){e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SendFeedbackReceipt,params:{networkId:a,accountId:o,txid:I.txid,type:"Send"}}})}),10)}catch(A){var T,S=(null==A||null==(T=A.data)?void 0:T.message)||A.message;s.default.swap.error("swap send failed with message "+S),f.deviceUtils.showErrorToast(A,S),null==j||j(A)}else e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SendConfirm,params:{accountId:o,networkId:a,payloadInfo:d,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:r,prepaidFee:u,hideSendFeedbackReceipt:!O,onDetail:h,onSuccess:function(e,t){var n;null==b||b({result:e,decodedTx:null!=(n=null==t?void 0:t.decodedTx)?n:void 0})}}}})}));return function(e){return n.apply(this,arguments)}}(),[t,e])}function b(){var e=Object(d.default)(),t=Object(u.useAppSelector)((function(e){return e.settings.validationSetting}));return Object(a.useCallback)(function(){var n=o()((function*(n){var r=n.accountId,o=n.networkId,a=n.unsignedMessage,s=n.onSuccess,d=n.onFail,u=Object(p.createLoggerTimer)(),j=Object(i.getWalletIdFromAccountId)(r),b=yield c.default.engine.getWallet(j),h=(yield c.default.servicePassword.getPassword())&&!(null!=t&&t.Payment);if("hw"===b.type||"external"!==b.type&&h)try{u.start(p.LoggerTimerTags.signMessage);var g=yield c.default.serviceTransaction.signMessage({accountId:r,networkId:o,unsignedMessage:a});u.end(p.LoggerTimerTags.signMessage),yield null==s?void 0:s(g)}catch(v){var O;f.deviceUtils.showErrorToast(v,(null==v||null==(O=v.data)?void 0:O.message)||v.message),null==d||d(v)}else e.navigate(l.RootRoutes.Modal,{screen:l.ModalRoutes.Send,params:{screen:m.SendModalRoutes.SignMessageConfirm,params:{accountId:r,networkId:o,unsignedMessage:a,onSuccess:s}}})}));return function(e){return n.apply(this,arguments)}}(),[e,t])}},4185:function(e,t,n){"use strict";n.r(t),n.d(t,"Options",(function(){return c}));var r=n(60),o=n(26),a=n(11),i=n(98),s=n(0),c=function(e){var t=e.title,c=e.subtitle,d=e.logo,u=e.num,l=e.onPress;return Object(s.jsxs)(r.default,{onPress:l,bg:"surface-default",px:"4",py:"3",flexDirection:"row",justifyContent:"space-between",borderRadius:12,children:[Object(s.jsxs)(a.default,{flexDirection:"row",alignItems:"center",children:[Object(s.jsxs)(a.default,{mr:"3",position:"relative",children:[Object(s.jsx)(a.default,{w:"10",h:"10",borderRadius:"full",overflow:"hidden",children:Object(s.jsx)(i.default,{w:"10",h:"10",source:n(4186)})}),Object(s.jsx)(a.default,{w:"5",h:"5",background:"surface-subdued",flexDirection:"row",justifyContent:"center",alignItems:"center",borderRadius:"full",position:"absolute",bottom:"-1",right:"-1",children:Object(s.jsx)(i.default,{w:"4",h:"4",source:d})})]}),Object(s.jsxs)(a.default,{children:[Object(s.jsx)(o.default.Body1Strong,{children:t}),Object(s.jsx)(o.default.Body2,{color:"text-subdued",children:c})]})]}),Object(s.jsx)(a.default,{flexDirection:"row",justifyContent:"center",alignItems:"center",children:Object(s.jsx)(o.default.Body1Strong,{color:"text-success",children:u})})]})}},4186:function(e,t,n){e.exports=n.p+"static/media/eth_logo.ff687f08.png"},4187:function(e,t,n){"use strict";n.r(t),n.d(t,"SwapTransactionsCancelApprovalBottomSheetModal",(function(){return l}));var r=n(484),o=n(38),a=n(53),i=n(49),s=n(26),c=n(1),d=n(89),u=n(0),l=function(e){var t=e.close,n=e.onSubmit,l=Object(d.default)(),f=Object(c.useCallback)((function(){t(),n()}),[t,n]);return Object(u.jsxs)(r.default,{closeOverlay:t,title:"",showHeader:!1,children:[Object(u.jsx)(i.default,{h:"16",children:Object(u.jsx)(s.default.Heading,{fontSize:60,children:" \u2139\ufe0f "})}),Object(u.jsx)(s.default.DisplayMedium,{mt:"4",children:l.formatMessage({id:"msg__need_to_send_str_transactions_to_change_allowance"},{0:"2"})}),Object(u.jsx)(s.default.Body1,{color:"text-subdued",my:"4",children:l.formatMessage({id:"msg__modifying_the_authorized_limit_of_usdt_requires_resetting_it_to_zero_first_so_two_authorization_transactions_may_be_initiated"})}),Object(u.jsxs)(o.default,{flexDirection:"row",space:"4",children:[Object(u.jsx)(a.default,{size:"xl",type:"basic",onPress:t,flex:"1",children:l.formatMessage({id:"action__cancel"})}),Object(u.jsx)(a.default,{size:"xl",type:"primary",onPress:f,flex:"1",children:l.formatMessage({id:"action__confirm"})})]})]})}},4338:function(e,t,n){"use strict";n.r(t),n.d(t,"useSwapSubmit",(function(){return B}));var r=n(3),o=n.n(r),a=n(4),i=n.n(a),s=n(45),c=n(2),d=n.n(c),u=n(1),l=n(21),f=n.n(l),m=n(89),p=n(113),j=n(12),b=n(153),h=n(18),g=n(17),O=n(24),v=n(16),y=n(192),k=n(212),w=n(254),x=n(47),I=n(90),_=n(4187),T=n(4045),S=n(964),A=n(173),R=n(4080),M=n(0);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(){var e=d()((function*(e){var t,n,r,o,a=e.hash,i=e.decodedTx,s=e.params,c=e.response,d=e.recipient,u=e.quote,l=null==c?void 0:c.result;if(void 0!==c&&void 0!==l){var m,p=[Object(k.clearState)()],j=l.sellAmount||u.sellAmount,h=l.buyAmount||u.buyAmount,O=u.type,v=u.quoterlogo,x=yield g.default.engine.getNetwork(s.tokenIn.networkId),I=yield g.default.engine.getNetwork(s.tokenIn.networkId),_=Object(A.getTokenAmountValue)(s.tokenIn,j),S=Object(A.getTokenAmountValue)(s.tokenOut,h),R=null==i?void 0:i.nonce;i&&(m=Object(A.calculateDecodedTxNetworkFee)(i,x));var M={networkId:s.tokenIn.networkId,token:s.tokenIn,amount:Object(A.formatAmount)(new f.a(l.sellAmount).shiftedBy(-s.tokenIn.decimals))||Object(A.formatAmount)(_)},C={networkId:s.tokenOut.networkId,token:s.tokenOut,amount:Object(A.formatAmount)(new f.a(l.buyAmount).shiftedBy(-s.tokenOut.decimals))||Object(A.formatAmount)(S)};p.push(Object(w.addTransaction)({accountId:s.activeAccount.id,networkId:s.tokenIn.networkId,transaction:{hash:a,from:s.activeAccount.address,addedTime:Date.now(),status:"pending",type:"swap",accountId:s.activeAccount.id,networkId:s.tokenIn.networkId,quoterType:O,quoterLogo:v,nonce:R,attachment:c.attachment,receivingAccountId:null==d?void 0:d.accountId,receivingAddress:null==d?void 0:d.address,providers:null!=(t=null==l?void 0:l.sources)?t:u.providers,arrivalTime:u.arrivalTime,percentageFee:u.percentageFee,protocalFees:u.protocolFees,networkFee:m,viewed:!1,tokens:{from:M,to:C,rate:Number(null!=(n=null==l?void 0:l.instantRate)?n:u.instantRate)}}}));var N,P=Object(y.appSelector)((function(e){return e.swapTransactions.slippage}));if(P&&P.autoReset&&p.push(Object(w.setSlippage)({mode:"auto"})),g.default.dispatch.apply(g.default,p),g.default.serviceToken.addAccountToken(s.tokenIn.networkId,s.activeAccount.id,s.tokenIn.tokenIdOnNetwork),s.tokenIn.networkId===s.tokenOut.networkId&&g.default.serviceToken.addAccountToken(s.tokenOut.networkId,s.activeAccount.id,s.tokenOut.tokenIdOnNetwork),"swftc"===(null==(r=c.result)?void 0:r.quoter)&&null!=(o=c.attachment)&&o.swftcOrderId)T.SwapQuoter.client.swftModifyTxId(null==(N=c.attachment)?void 0:N.swftcOrderId,a);var B=null==x?void 0:x.shortName,D=null==I?void 0:I.shortName;g.default.serviceSwap.addRecord({txid:a,from:{networkId:M.networkId,networkName:null!=B?B:"",tokenAddress:M.token.tokenIdOnNetwork,tokenName:M.token.name,amount:M.amount},to:{networkId:C.networkId,networkName:null!=D?D:"",tokenAddress:C.token.tokenIdOnNetwork,tokenName:C.token.name,amount:C.amount},params:s,response:c}),b.appUIEventBus.emit(b.AppUIEventBusNames.SwapAddTransaction)}}));return function(t){return e.apply(this,arguments)}}();var B=function(){var e=Object(m.default)(),t=Object(R.useSwapSend)(),n=Object(O.useNavigation)();return Object(u.useCallback)(function(){var r=d()((function*(r){var o,a,c=r.params,u=r.quote,l=r.recipient,m=r.onSuccess,O=r.setProgressStatus,k=r.openProgressStatus,w=r.closeProgressStatus;if(c&&u&&l){var R=c.activeAccount,C=new A.TokenAmount(c.tokenIn,Object(A.getTokenAmountValue)(c.tokenIn,u.sellAmount).toFixed()),B="0";c.tokenIn.tokenIdOnNetwork||(B=C.value.toFixed());var D=new A.TokenAmount(c.tokenOut,Object(A.getTokenAmountValue)(c.tokenOut,u.buyAmount).toFixed());if(yield g.default.serviceSwap.checkAccountInWallets(R.id)){var E=c.tokenIn.networkId,F=yield g.default.engine.getNetwork(E);if(F){var L=Object(A.createLoggerTimer)();L.start(A.LoggerTimerTags.checkTokenBalance),null==O||O({title:e.formatMessage({id:"action__confirming_balance_str"},{0:""})});var U=yield g.default.serviceToken.getAccountBalanceFromRpc(F.id,R.id,[],!0),H=i()(U,1)[0],q=null==H||null==(o=H.main)?void 0:o.balance,Q=q?c.tokenIn.networkId+" native token balance is "+q:c.tokenIn.networkId+" failed to fetch native token balance";h.default.swap.info(Q),L.end(A.LoggerTimerTags.checkTokenBalance);var V=new f.a(null!=q?q:"0");if(V.isZero()){var z=yield g.default.engine.getNativeTokenInfo(E);s.default.show({title:e.formatMessage({id:"msg__str_insufficient_balance_to_pay_for_gas_fee"},{0:z.symbol.toUpperCase()})},{type:"error"})}else{var K=0;if(V.gt(0))try{var W,G=yield g.default.servicePassword.getPassword(),J=yield g.default.engine.getFrozenBalance({accountId:R.id,networkId:F.id,password:G});h.default.swap.info("get frozenBalance ",J),K="number"===typeof J?J:null!=(W=null==J?void 0:J[c.tokenIn.id])?W:0}catch(xe){h.default.swap.info("failed to get frozen balanace",xe.message)}var $=yield g.default.serviceSwap.getReservedNetworkFee(F.id);if($=Object(A.plus)($,K),(c.tokenIn.tokenIdOnNetwork?V:V.minus(C.typedValue)).lt($)){var X=(yield g.default.engine.getNativeTokenInfo(E)).symbol.toUpperCase(),Y=0===K?e.formatMessage({id:"msg__suggest_reserving_str_as_gas_fee"},{0:$+" "+X}):e.formatMessage({id:"msg__insufficient_funds_for_transaction"},{0:K+" "+X,1:$+" "+X});s.default.show({title:Y},{type:"error"})}else{var Z,ee=N(N({},c),{},{activeAccount:R,receivingAddress:null==l?void 0:l.address,txData:u.txData,additionalParams:u.additionalParams,sellAmount:u.sellAmount,buyAmount:u.buyAmount,disableValidate:!0});try{L.start(A.LoggerTimerTags.buildTransaction),null==O||O({title:e.formatMessage({id:"action__building_transaction_data_str"},{0:""})}),Z=yield T.SwapQuoter.client.buildTransaction(u.type,ee),L.end(A.LoggerTimerTags.buildTransaction)}catch(xe){var te,ne,re=(null==xe||null==(te=xe.response)||null==(ne=te.data)?void 0:ne.message)||xe.message;return void s.default.show({title:re},{type:"error"})}if(void 0!==Z&&null!=(a=Z)&&a.data){var oe=function(e){var t=e.swapQuote,n=e.quoteParams,r=e.inputAmount,o=e.outputAmount,a=e.account,i=e.receivingAddress,s=n.networkIn,c=n.networkOut,d=n.tokenIn,u=n.tokenOut,l=n.slippagePercentage,f=n.independentField;return{accountAddress:a.address,receivingAddress:i,send:{networkId:s.id,tokenInfo:d,amount:r.typedValue,amountValue:r.amount.toFixed()},receive:{networkId:c.id,tokenInfo:u,amount:o.typedValue,amountValue:o.amount.toFixed()},slippagePercentage:l,independentField:f,swapQuote:t}}({quoteParams:c,inputAmount:C,outputAmount:D,swapQuote:u,account:R,receivingAddress:null==l?void 0:l.address}),ae=Z.data;if(void 0!==ae){if(F.impl===j.IMPL_EVM){var ie=ae.value;ie.startsWith("0x")||(ae.value=Object(A.toHex)(ie))}h.default.swap.info("swap encodedTx: ",JSON.stringify(ae));var se=Z.result;if(se){var ce,de,ue=Object(p.getWalletIdFromAccountId)(R.id),le=yield g.default.engine.getWallet(ue),fe=!1;if(se.allowanceTarget&&c.tokenIn.tokenIdOnNetwork){L.start(A.LoggerTimerTags.checkTokenAllowance);var me=yield g.default.engine.getTokenAllowance({networkId:c.tokenIn.networkId,accountId:c.activeAccount.id,tokenIdOnNetwork:c.tokenIn.tokenIdOnNetwork,spender:se.allowanceTarget});L.end(A.LoggerTimerTags.checkTokenAllowance),me?(h.default.swap.info(c.tokenIn.networkId+" "+c.tokenIn.symbol+" allowance is "+me),fe=new f.a(Object(A.getTokenAmountString)(c.tokenIn,me)).lt(se.sellAmount)):h.default.swap.info(c.tokenIn.networkId+" "+c.tokenIn.symbol+" failed to fetch token allowance");var pe=yield g.default.serviceSwap.needToResetApproval(c.tokenIn);if(fe&&pe&&Number(me||"0")>0&&(de=yield g.default.engine.buildEncodedTxFromApprove({spender:se.allowanceTarget,networkId:c.tokenIn.networkId,accountId:R.id,token:c.tokenIn.tokenIdOnNetwork,amount:"0"})),fe){var je=Object(y.appSelector)((function(e){return e.settings.disableSwapExactApproveAmount}))?"unlimited":Object(A.getTokenAmountValue)(c.tokenIn,se.sellAmount).toFixed();ce=yield g.default.engine.buildEncodedTxFromApprove({spender:se.allowanceTarget,networkId:c.tokenIn.networkId,accountId:R.id,token:c.tokenIn.tokenIdOnNetwork,amount:je}),de&&de.nonce&&(ce.nonce=Number(de.nonce)+1)}}var be=[],he=function(){var r=d()((function*(){null==O||O({title:e.formatMessage({id:"action__swapping_str"},{0:""})});try{yield t({accountId:R.id,networkId:E,gasEstimateFallback:Boolean(ce),encodedTx:ae,showSendFeedbackReceipt:!0,payloadInfo:{type:"InternalSwap",swapInfo:oe},prepaidFee:B,onDetail:function(e){n.navigate(v.RootRoutes.Modal,{screen:v.ModalRoutes.Swap,params:{screen:S.SwapRoutes.Transaction,params:{txid:e}}})},onSuccess:function(){var e=d()((function*(e){var t=e.result,n=e.decodedTx;Z&&(yield P({hash:t.txid,decodedTx:n,params:ee,response:Z,quote:u,recipient:l}),b.appUIEventBus.emit(b.AppUIEventBusNames.SwapCompleted),null==m||m({result:t,decodedTx:n}))}));return function(t){return e.apply(this,arguments)}}(),onFail:function(){b.appUIEventBus.emit(b.AppUIEventBusNames.SwapError)}})}finally{null==w||w()}}));return function(){return r.apply(this,arguments)}}();if(be.unshift(he),ce){var ge=function(){var r=d()((function*(r){var o={type:"InternalSwap"};"external"!==le.type&&(o.swapInfo=N(N({},oe),{},{isApprove:!0})),L.start(A.LoggerTimerTags.approval),null==O||O({title:e.formatMessage({id:"action__authorizing_str"},{0:""})}),yield t({accountId:R.id,networkId:E,payloadInfo:o,encodedTx:ce,gasEstimateFallback:Boolean(de),onSuccess:function(){var e=d()((function*(){"hw"===le.type&&n.navigate(v.RootRoutes.Modal,{screen:v.ModalRoutes.Send,params:{screen:v.SendModalRoutes.HardwareSwapContinue,params:{networkId:E,accountId:R.id}}}),yield null==r?void 0:r()}));return function(){return e.apply(this,arguments)}}(),onFail:function(){null==w||w()}}),L.end(A.LoggerTimerTags.approval)}));return function(e){return r.apply(this,arguments)}}();be.unshift(ge)}if(de){var Oe=function(){var e=d()((function*(e){var n={type:"InternalSwap"};"external"!==le.type&&(n.swapInfo=N(N({},oe),{},{isApprove:!0})),L.start(A.LoggerTimerTags.cancelApproval),yield t({accountId:R.id,networkId:E,payloadInfo:n,encodedTx:de,onSuccess:function(){var t=d()((function*(){yield null==e?void 0:e()}));return function(){return t.apply(this,arguments)}}()}),L.end(A.LoggerTimerTags.cancelApproval)}));return function(t){return e.apply(this,arguments)}}();be.unshift(Oe)}de?Object(I.showOverlay)((function(e){return Object(M.jsx)(_.SwapTransactionsCancelApprovalBottomSheetModal,{close:e,onSubmit:d()((function*(){try{null==k||k(),yield Object(A.combinedTasks)(be)}finally{null==w||w()}}))})})):yield Object(A.combinedTasks)(be),yield Object(x.wait)(1e3)}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else{var ve,ye,ke,we=null!=(ve=null==(ye=Z)||null==(ke=ye.error)?void 0:ke.msg)?ve:e.formatMessage({id:"msg__unknown_error"});s.default.show({title:we},{type:"error"})}}}}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__account_deleted"},{0:R.name})},{type:"error"})}else s.default.show({title:e.formatMessage({id:"msg__unknown_error"})},{type:"error"})}));return function(e){return r.apply(this,arguments)}}(),[])}},4339:function(e,t,n){e.exports=n.p+"static/media/logo.b0cff82f.png"},5252:function(e,t,n){e.exports=n.p+"static/media/eth_staking.c3ba7ecb.png"},5253:function(e,t,n){e.exports=n.p+"static/media/eth_unstake.3014a6f3.png"},5254:function(e,t,n){e.exports=n.p+"static/media/logo_black.0d059a6e.png"},5312:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n.n(r),a=n(50),i=n(57),s=n(56),c=n(1),d=n(42),u=n(89),l=n(35),f=n(24),m=n(681),p=n(4185),j=n(1609),b=n(0),h=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),r=t.params.networkId,o=Object(f.useAppSelector)((function(e){return e.staking.ethStakingApr})),a=Object(c.useMemo)((function(){if(!o)return[];var e=r===l.OnekeyNetwork.goerli?o.testnet:o.mainnet;return[{name:j.EthStakingSource.Kele,value:Object(m.formatAmount)(e.kele,2)+"%",logo:n(1384)},{name:j.EthStakingSource.Lido,value:Object(m.formatAmount)(e.lido,2)+"%",logo:n(4042)}]}),[r,o]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"form__str_pools"},{0:"ETH"}),footer:null,children:Object(b.jsx)(s.default,{space:4,children:a.map((function(e){return Object(b.jsx)(p.Options,{title:"ETH",subtitle:e.name,logo:e.logo,num:e.value,onPress:function(){null==t.params.onSelector||t.params.onSelector(e.name)}},e.name)}))})})},g=n(427),O=n(161),v=n.n(O),y=n(60),k=n(576),w=n(38),x=n(20),I=n(45),_=n(2),T=n.n(_),S=n(4),A=n.n(S),R=n(484),M=n(53),C=n(49),N=n(11),P=n(40),B=n(26),D=n(98),E=n(21),F=n.n(E),L=n(17),U=n(1630),H=n(111),q=n(196),Q=n(16),V=n(501),z=n(90),K=n(103),W=n(173),G=(n(1368),n(306)),J=(n(25),function(e){e.text,e.onTextChange,Object(G.default)().height,Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]);return null}),$=n(6124),X=n(113),Y=n(566);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e,t){return Object(c.useEffect)((function(){Object(W.isEvmNetworkId)(e)&&Object(X.isAccountCompatibleWithNetwork)(t,e)&&L.default.serviceStaking.fetchKeleUnstakeOverview({networkId:e,accountId:t})}),[e,t]),Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleUnstakeOverviews)||null==(o=r[t])?void 0:o[e]}))}function ne(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleMinerOverviews)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}function re(e){return Object(f.useAppSelector)((function(t){var n;return null==(n=t.staking.keleNetworkDashboardGlobal)?void 0:n[null!=e?e:""]}))}function oe(e){var t=Object(u.default)(),n=Math.floor(e/1440);if(n>0)return n+" "+t.formatMessage({id:"content__day"});var r=Math.floor(e/60);return r>0?r+" "+t.formatMessage({id:"content__hours"}):e+" "+t.formatMessage({id:"content__minutes_lowercase"})}function ae(e,t){var n=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleIncomes)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(e,t),r=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleOpHistory)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(e,t);return Object(c.useMemo)((function(){var e=[];return n&&n.length&&(e=e.concat(n.map((function(e){return{type:"income",income:e,time:new Date(e.date).getTime()}})))),r&&r.length&&(e=e.concat(r.map((function(e){return{type:"op",op:e,time:Object($.default)(e.history_time,"yyyy-MM-dd HH:mm:ss",new Date).getTime()}})))),e.sort((function(e,t){return t.time-e.time}))}),[n,r])}var ie=function(e,t){var n=Object(f.useAppSelector)((function(e){return e.staking.lidoOverview})),r=Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.tokens.accountTokensBalance)||null==(o=r[null!=e?e:""])?void 0:o[null!=t?t:""]}));return Object(c.useMemo)((function(){var o,a,i;if(e&&t){var s=null==n||null==(o=n[t])?void 0:o[e],c=e===l.OnekeyNetwork.eth?Y.MainnetLidoContractAddress:Y.TestnetLidoContractAddress,d=null==r||null==(a=r[c.toLowerCase()])?void 0:a.balance;return ee(ee({},s),{},{balance:null!=d?d:null==s?void 0:s.balance,nfts:null!=(i=null==s?void 0:s.nfts)?i:[]})}}),[e,t,n,r])};function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var de=function(e){return e.source===j.EthStakingSource.Lido?Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"5",h:"5",source:n(4042)},"lido"),Object(b.jsx)(B.default.Body2Strong,{ml:"2",children:"Lido"}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"5",h:"5",source:n(1384)},"kele"),Object(b.jsx)(B.default.Body2Strong,{ml:"2",children:"Kele"}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]})},ue=function(e){var t=e.mode,n=Object(u.default)();return t===j.KeleStakingMode.fast?Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default.Body1Strong,{mr:"2",children:"\ud83d\ude85"}),Object(b.jsx)(B.default.Body2Strong,{children:n.formatMessage({id:"content__fast"})}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default.Body1Strong,{mr:"2",children:"\ud83d\ude95"}),Object(b.jsx)(B.default.Body2Strong,{children:n.formatMessage({id:"content__normal"})}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]})},le=function(e){return Object(b.jsx)(B.default.Body1,{color:"text-default",children:e})},fe=function(e){var t=e.closeOverlay,n=e.amount,r=e.remain,o=e.onConfirm,a=Object(u.default)(),i=Object(c.useCallback)((function(){t(),null==o||o()}),[t,o]);return Object(b.jsxs)(R.default,{closeOverlay:t,title:a.formatMessage({id:"title__staking_tips"}),children:[Object(b.jsx)(C.default,{children:Object(b.jsx)(B.default.Heading,{pt:"6",pb:"2",fontSize:60,fontWeight:600,lineHeight:70,children:"\ud83d\udcb8"})}),Object(b.jsx)(B.default.DisplayLarge,{textAlign:"center",children:a.formatMessage({id:"modal__insufficient_balance_in_system_address"})}),Object(b.jsx)(N.default,{my:"6",children:Object(b.jsx)(B.default.Body1,{color:"text-subdued",textAlign:"center",children:a.formatMessage({id:"modal__insufficient_balance_in_system_address_desc"},{0:n+" ETH",1:r+" ETH",a:le,b:le})})}),Object(b.jsx)(C.default,{h:"10",w:"full",children:Object(b.jsx)(M.default,{w:"full",size:"xl",type:"primary",onPress:i,children:a.formatMessage({id:"action__i_got_it"})})})]})};var me=n(340),pe=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),r=Object(d.useNavigation)(),o=Object(c.useCallback)((function(){r.replace(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnKele,params:{networkId:t.params.networkId,accountId:t.params.accountId}}})}),[r,t.params]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"modal__transaction_submitted"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__close",onPrimaryActionPress:o,children:Object(b.jsxs)(s.default,{alignItems:"center",justifyContent:"center",flex:1,children:[Object(b.jsx)(N.default,{w:"200px",h:"200px",children:Object(b.jsx)(me.default,{width:200,source:n(1629),autoPlay:!0,loop:!1})}),Object(b.jsx)(x.default,{typography:"DisplayMedium",children:e.formatMessage({id:"action__submit"})}),Object(b.jsx)(N.default,{h:8})]})})},je=n(18),be=n(5252),he=n.n(be);function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=n(5253),ye=n.n(ve);var ke=n(195),we=n(344),xe=function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.mode,a=n.onSelector,l=re(r),f=Number(null!=(e=null==l?void 0:l.validator_alive_predicted_hour)?e:"24"),m=f>24?t.formatMessage({id:"form__str_day"},{0:Math.ceil(f/24)}):t.formatMessage({id:"form__str_hours"},{0:f});return Object(c.useEffect)((function(){l||L.default.serviceStaking.getDashboardGlobal({networkId:r})}),[]),Object(b.jsx)(i.default,{header:t.formatMessage({id:"content__mode"}),footer:null,children:Object(b.jsxs)(s.default,{space:1,children:[Object(b.jsxs)(we.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,p:"2",bgColor:o===j.KeleStakingMode.normal?"surface-selected":void 0,onPress:function(){return null==a?void 0:a(j.KeleStakingMode.normal)},children:[Object(b.jsx)(N.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsxs)(w.default,{space:1,children:[Object(b.jsx)(B.default.Body1Strong,{children:"\ud83d\ude95"}),Object(b.jsx)(B.default.Body1Strong,{children:t.formatMessage({id:"content__normal"})})]})}),Object(b.jsxs)(N.default,{alignItems:"flex-end",children:[Object(b.jsxs)(B.default.Body2Strong,{children:["~ ",m]}),Object(b.jsx)(B.default.Body2Strong,{children:t.formatMessage({id:"content__estimated_time"})})]})]}),Object(b.jsxs)(we.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,p:"2",bgColor:o===j.KeleStakingMode.fast?"surface-selected":void 0,onPress:function(){return null==a?void 0:a(j.KeleStakingMode.fast)},children:[Object(b.jsx)(N.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsxs)(w.default,{space:1,children:[Object(b.jsx)(B.default.Body1Strong,{children:"\ud83d\ude85"}),Object(b.jsx)(B.default.Body1Strong,{children:t.formatMessage({id:"content__fast"})}),Object(b.jsx)(ke.default,{type:"info",title:t.formatMessage({id:"content__str_faster"},{0:"99.99%"}),size:"sm"})]})}),Object(b.jsxs)(N.default,{alignItems:"flex-end",children:[Object(b.jsxs)(B.default.Body2Strong,{children:["~ ",t.formatMessage({id:"form__str_minutes"},{0:"30"})]}),Object(b.jsx)(B.default.Body2Strong,{children:t.formatMessage({id:"content__estimated_time"})})]})]})]})})},Ie=n(593),_e=function(e){return Object(b.jsx)(B.default.Body1Strong,{color:"text-success",children:e})},Te=function(){var e=Object(u.default)();return Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(s.default,{space:4,children:[Object(b.jsxs)(N.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(N.default,{mr:"3",children:Object(b.jsx)(P.default,{name:"ChartBarOutline"})}),Object(b.jsx)(B.Body1Strong,{children:e.formatMessage({id:"form__earn_up_to_str_per_year"},{a:_e,0:"4.58%"})})]}),Object(b.jsxs)(N.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(N.default,{mr:"3",children:Object(b.jsx)(P.default,{name:"ArrowsRightLeftOutline"})}),Object(b.jsx)(N.default,{flex:"1",children:Object(b.jsx)(B.Body1Strong,{children:e.formatMessage({id:"form__when_you_stake_str_you_receive_str_you_can_trade_this_liquid_asset_at_any_time"},{a:_e,b:_e,0:"ETH",1:"stETH"})})})]}),Object(b.jsxs)(N.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(N.default,{mr:"3",children:Object(b.jsx)(P.default,{name:"ClockOutline"})}),Object(b.jsx)(N.default,{flex:"1",children:Object(b.jsx)(B.Body1Strong,{children:e.formatMessage({id:"form__you_start_earning_str"},{a:_e})})})]}),Object(b.jsxs)(N.default,{py:"3",px:"4",flexDirection:"row",borderRadius:12,bg:"surface-default",children:[Object(b.jsx)(N.default,{mr:"3",children:Object(b.jsx)(P.default,{name:"GiftOutline"})}),Object(b.jsx)(N.default,{flex:"1",children:Object(b.jsx)(B.Body1Strong,{children:e.formatMessage({id:"form__rewards_are_automatically_credited_to_your_deposit_every_few_days"},{a:_e})})})]})]}),Object(b.jsx)(Ie.default,{renderCustomTrigger:function(t,n){return Object(b.jsx)(N.default,{py:"4",children:n?Object(b.jsx)(M.default,{size:"sm",type:"plain",rightIconName:"ChevronDownMini",iconColor:"icon-subdued",textProps:{color:"text-subdued"},onPress:t,children:e.formatMessage({id:"action__learn_more"})}):Object(b.jsx)(M.default,{size:"sm",type:"plain",rightIconName:"ChevronUpMini",iconColor:"icon-subdued",textProps:{color:"text-subdued"},onPress:t,children:e.formatMessage({id:"action__collapse"})})})},children:Object(b.jsxs)(s.default,{children:[Object(b.jsx)(Ie.default,{trigger:Object(b.jsx)(B.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__how_does_the_lido_protocol_work"})}),children:Object(b.jsx)(B.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__how_does_the_lido_protocol_work_desc"})})}),Object(b.jsx)(Ie.default,{trigger:Object(b.jsx)(B.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__why_do_you_receive_steth"})}),children:Object(b.jsx)(B.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__why_do_you_receive_steth_desc"})})}),Object(b.jsx)(Ie.default,{trigger:Object(b.jsx)(B.default.Body1,{color:"text-default",children:e.formatMessage({id:"form__what_is_the_possible_risk_of_lido"})}),children:Object(b.jsx)(B.default.Body1,{px:"2",color:"text-subdued",children:e.formatMessage({id:"form__what_is_the_possible_risk_of_lido_desc"})})})]})})]})},Se=function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=Object(c.useCallback)((function(){n.readonly?t.goBack():t.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{accountId:n.networkId,networkId:n.networkId,source:j.EthStakingSource.Lido}}})}),[t,n]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:n.readonly?"action__i_got_it":"action__lets_go",onPrimaryActionPress:r,header:e.formatMessage({id:"form__staking"})+" ETH",scrollViewProps:{children:Object(b.jsx)(Te,{})}})},Ae=n(3993),Re=n(4338),Me=n(4043);function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe=function(e){return"lido"===e.value?Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"5",h:"5",source:n(4042)},"lido"),Object(b.jsx)(B.default.Body2Strong,{ml:"2",children:"Lido"}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]}):Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"5",h:"5",source:n(4339)},"onekey"),Object(b.jsx)(B.default.Body2Strong,{ml:"2",children:"OneKey Swap"}),Object(b.jsx)(P.default,{name:"ChevronRightMini"})]})};var Be=n(48),De=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,r=t.source,o=t.onSelector,a=t.amount,l=t.networkId,f=Object(c.useState)(!0),m=A()(f,2),p=m[0],j=m[1],h=Object(Be.useAppSelector)((function(e){return e.staking.stEthRate})),g=Object(c.useMemo)((function(){return null==h?void 0:h[l]}),[h,l]);return Object(c.useEffect)((function(){function e(){return(e=T()((function*(){var e=Object(Be.getActiveWalletAccount)(),t=e.account,n=e.networkId;if(t&&n){var r,o=yield Object(Me.fetchStEthRate)({networkId:n,account:t,amount:a}),i=null==o||null==(r=o.data)?void 0:r.instantRate;i&&(L.default.dispatch(Object(V.setStEthRate)({networkId:n,value:i})),j(!1))}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[a]),Object(b.jsx)(i.default,{footer:null,header:e.formatMessage({id:"form__route"}),children:Object(b.jsxs)(s.default,{space:"4",children:[Object(b.jsxs)(we.default,{flexDirection:"row",py:"3",px:"2",alignItems:"center",justifyContent:"space-between",bg:"lido"===r?"surface-selected":"background-default",borderRadius:12,onPress:function(){return null==o?void 0:o("lido")},children:[Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"10",h:"10",mr:"3",source:n(4042)}),Object(b.jsxs)(N.default,{flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body1Strong,{children:"Lido"}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__str_day"},{0:"~ 1 - 3"}).toLowerCase()})]})]}),Object(b.jsxs)(N.default,{flexDirection:"column",alignItems:"flex-end",children:[Object(b.jsxs)(B.default.Body1Strong,{color:"text-success",children:[a||"0"," ETH"]}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__you_receive"})})]})]}),Object(b.jsxs)(we.default,{flexDirection:"row",py:"3",px:"2",alignItems:"center",justifyContent:"space-between",bg:"onekey"===r?"surface-selected":"background-default",borderRadius:12,onPress:function(){return null==o?void 0:o("onekey")},children:[Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(D.default,{w:"10",h:"10",mr:"3",source:n(5254)}),Object(b.jsxs)(N.default,{flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body1Strong,{children:"OneKey Swap"}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"content__str_minutes_plural"},{0:"~ 1-5"})})]})]}),Object(b.jsxs)(N.default,{flexDirection:"column",alignItems:"flex-end",children:[a?Object(b.jsx)(N.default,{children:g&&!p?Object(b.jsxs)(B.default.Body1Strong,{color:"text-success",children:[Object(W.formatAmount)(Object(W.multiply)(g,a),6)," ETH"]}):Object(b.jsx)(N.default,{w:"6",h:"4",overflow:"hidden",borderRadius:12,children:Object(b.jsx)(k.default,{})})}):Object(b.jsx)(B.default.Body1Strong,{color:"text-success",children:"0 ETH"}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__you_receive"})})]})]})]})})},Ee=function(){var e=Object(u.default)();return Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(C.default,{mt:"8",mb:"10",children:[Object(b.jsx)(D.default,{w:"24",h:"24",mb:"2",source:n(4042)}),Object(b.jsx)(B.default.DisplayLarge,{children:e.formatMessage({id:"title__lido_unstaking"})}),Object(b.jsx)(B.default.Body1,{color:"text-subdued",mt:"2",children:e.formatMessage({id:"title__lido_unstaking_desc"})})]}),Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(C.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(B.default.Body2Strong,{color:"decorative-icon-one",children:"1"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"form__request_withdrawal"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__request_withdrawal_desc"})})]})]}),Object(b.jsxs)(N.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(C.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(B.default.Body2Strong,{color:"decorative-icon-one",children:"2"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"form__receive_lido_nft"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__receive_lido_nft_desc"})})]})]}),Object(b.jsxs)(N.default,{flexDirection:"row",mb:"8",children:[Object(b.jsx)(C.default,{w:"8",h:"8",mr:"2",borderRadius:"full",bg:"decorative-surface-one",children:Object(b.jsx)(B.default.Body2Strong,{color:"decorative-icon-one",children:"3"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"form__claim"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__claim_desc"})})]})]})]})]})},Fe=function(){var e=Object(u.default)(),t=Object(d.useRoute)(),n=Object(d.useNavigation)(),r=Object(c.useCallback)((function(){n.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstake,params:{accountId:t.params.accountId,networkId:t.params.networkId}}})}),[n,t.params]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:"action__i_got_it",onPrimaryActionPress:r,header:e.formatMessage({id:"action_unstake"})+" ETH",scrollViewProps:{children:Object(b.jsx)(Ee,{})}})},Le=n(194),Ue=n(78),He=n(177),qe=n(100),Qe=n(3832),Ve=n(28),ze=n(6),Ke=n.n(ze),We=function(){function e(e){this.tx=e.tx,this.onFinish=e.onFinish}var t=e.prototype;return t.run=function(){var e=this;this.runTask();var t=this.getMs();t?this.timer=setTimeout((function(){e.run()}),t):this.stop()},t.stop=function(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)},t.getMs=function(){var e=this.tx.addedTime;return Date.now()-e<=36e5?2e4:3e5},t.queryTransactionProgress=function(){var e=T()((function*(e){var t=e.networkId,n=e.accountId,r=e.nonce;if(void 0!==r)return{status:yield L.default.serviceHistory.queryTransactionNonceStatus({networkId:t,accountId:n,nonce:r})}}));return function(t){return e.apply(this,arguments)}}(),t.runTask=function(){var e=T()((function*(){var e=this,t=this.tx,n=yield this.queryTransactionProgress(t);if(n){var r,o=n.status;if(o&&"pending"!==o)null==(r=this.onFinish)||r.call(this,{stop:function(){return e.stop()}})}}));return function(){return e.apply(this,arguments)}}(),Ke()(e)}(),Ge=function(e){var t=e.tx;return Object(c.useEffect)((function(){var e=new We({tx:t,onFinish:function(e){(0,e.stop)(),L.default.dispatch(Object(V.archiveTransaction)({accountId:t.accountId,networkId:t.networkId,txs:[t.hash]})),L.default.serviceStaking.fetchLidoOverview({accountId:t.accountId,networkId:t.networkId})}});return e.run(),function(){e.stop()}}),[]),null},Je=function(e){var t=e.tx;return Object(c.useEffect)((function(){var e=new We({tx:t,onFinish:function(){var e=T()((function*(e){var n=e.stop,r=yield L.default.serviceStaking.fetchKeleOpHistory({networkId:t.networkId,accountId:t.accountId}),o=null==r?void 0:r.find((function(e){return e.transaction_id.toLowerCase()===t.hash.toLowerCase()})),a=Date.now();(o||a-t.addedTime>864e5)&&(n(),L.default.dispatch(Object(V.archiveKeleTransaction)({accountId:t.accountId,networkId:t.networkId,txs:[t.hash]})),L.default.serviceStaking.fetchMinerOverview({networkId:t.networkId,accountId:t.accountId}))}));return function(t){return e.apply(this,arguments)}}()});return e.run(),function(){e.stop()}}),[]),null};function $e(e){return Number(e)>0?"+"+Object(m.formatAmount)(e,18):Object(m.formatAmount)(e,18)}var Xe=function(){var e,t,n=Object(u.default)(),r=Object(d.useNavigation)(),o=Object(d.useRoute)().params,a=o.networkId,i=o.accountId,s=ne(a,i),l=Object(c.useCallback)((function(){r.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,params:{networkId:a,accountId:i}}})}),[r,a,i]),f=Object(c.useCallback)((function(){r.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.WithdrawAmount,params:{networkId:a,accountId:i}}})}),[r,a,i]);return Object(b.jsxs)(N.default,{borderRadius:12,flexDirection:"row",px:"3",py:"3",mt:"3",borderWidth:Ve.default.hairlineWidth,borderColor:"border-subdued",justifyContent:"space-between",children:[Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Caption,{color:"text-subdued",fontSize:"14px",children:n.formatMessage({id:"form__staking_uppercase"})}),Object(b.jsxs)(N.default,{mb:"2",mt:"1",flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default.Body1,{children:Object(m.formatAmount)(null!=(e=null==s?void 0:s.amount.retail_staked)?e:"0",8)}),Object(b.jsx)(B.default.Body1,{children:" ETH"})]}),Object(b.jsx)(N.default,{flexDirection:"row",children:Object(b.jsx)(M.default,{size:"xs",onPress:l,children:n.formatMessage({id:"action_unstake"})})})]}),Object(b.jsx)(N.default,{w:"6",flexDirection:"row",justifyContent:"center",alignItems:"center",children:Object(b.jsx)(qe.default,{orientation:"vertical",color:"divider"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Caption,{color:"text-subdued",fontSize:"14px",children:n.formatMessage({id:"form__unstaked_uppercase"})}),Object(b.jsxs)(N.default,{mb:"2",mt:"1",flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default.Body1,{children:Object(m.formatAmount)(null!=(t=null==s?void 0:s.amount.withdrawable)?t:"0",8)}),Object(b.jsx)(B.default.Body1,{children:" ETH"})]}),Object(b.jsx)(N.default,{flexDirection:"row",children:Object(b.jsx)(M.default,{size:"xs",onPress:f,children:n.formatMessage({id:"action__withdraw"})})})]})]})},Ye=function(){var e,t,n=Object(u.default)(),r=Object(d.useRoute)().params,o=r.networkId,a=r.accountId,i=ne(o,a),s=Number(null!=(e=null==i?void 0:i.amount.retail_unstaking)?e:0),l=te(o,a),f=null!=(t=null==l?void 0:l.estimate_use_sec)?t:60,p=oe(Math.floor(f/60));return Object(c.useEffect)((function(){if(s){var e=setInterval((function(){L.default.serviceStaking.fetchMinerOverview({networkId:o,accountId:a})}),3e4);return function(){return clearInterval(e)}}}),[o,a,s]),s?Object(b.jsx)(N.default,{mb:"2",children:Object(b.jsx)(He.default,{dismiss:!1,alertType:"info",title:n.formatMessage({id:"msg__unstaking_in_progress_str"},{0:Object(m.formatAmount)(s,8)+" ETH "}),description:n.formatMessage({id:"msg__unstaking_in_progress_str_desc"},{0:" "+p})})}):null},Ze=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=function(e,t){return Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.kelePendingWithdraw)||null==(o=r[null!=t?t:""])?void 0:o[null!=e?e:""]}))}(n,r);return Object(c.useEffect)((function(){if(o){var e=setInterval((function(){L.default.serviceStaking.fetchPendingWithdrawAmount({networkId:n,accountId:r})}),12e4);return function(){return clearInterval(e)}}}),[n,r,o]),o?Object(b.jsx)(N.default,{mb:"2",children:Object(b.jsx)(He.default,{dismiss:!1,alertType:"info",title:e.formatMessage({id:"msg__withdraw_in_progress_str"},{0:Object(m.formatAmount)(o,8)+" ETH"})})}):null},et=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=Object(f.useAppSelector)((function(e){return e.staking.keleTransactions})),a=Object(c.useMemo)((function(){var e,t;return o?(null!=(e=null==(t=o[r])?void 0:t[n])?e:[]).filter((function(e){return!e.archive&&"KeleStake"===e.type})):[]}),[o,n,r]),i=a.reduce((function(e,t){var n;return e+Number(null!=(n=t.amount)?n:0)}),0);return i>0?Object(b.jsxs)(N.default,{mb:"2",children:[Object(b.jsx)(He.default,{alertType:"info",title:e.formatMessage({id:"msg__str_is_staking_in_progress"},{0:i+" ETH"}),dismiss:!1}),a.map((function(e){return Object(b.jsx)(Je,{tx:e},e.hash)}))]}):null},tt=function(){var e,t,n,r,o,a,i,s=Object(u.default)(),l=Object(d.useRoute)().params,p=l.networkId,h=l.accountId,g=ne(p,h),O=Object(q.useNativeToken)(p),v=Object(f.useTokenBalance)({networkId:p,accountId:h,token:O}),y=Object(d.useNavigation)(),k=Object(q.useSimpleTokenPriceValue)({networkId:p}),w=re(p),x=Object(c.useCallback)((function(){y.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,params:{networkId:p,accountId:h,readonly:!0}}})}),[y,p,h]),I=Object(c.useCallback)((function(){y.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{accountId:h,networkId:p,source:j.EthStakingSource.Kele}}})}),[y,h,p]),_=Number(null!=(e=null==g||null==(t=g.amount)?void 0:t.total_amount)?e:0)+Number(null!=(n=null==g?void 0:g.amount.withdrawable)?n:0),T=Object(m.formatAmount)(_,8),S=Number(T)!==_,A=Number(null!=(r=null==g||null==(o=g.amount)?void 0:o.staking_amount)?r:0);return Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",w:"full",alignItems:"center",children:[Object(b.jsx)(B.default.Heading,{children:s.formatMessage({id:"content__total"})}),Object(b.jsx)(Ue.default,{type:"plain",name:"QuestionMarkCircleOutline",size:"sm",onPress:x})]}),Object(b.jsxs)(N.default,{mt:"2",children:[Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[S?Object(b.jsx)(B.default.Caption,{mr:"1",children:"~"}):null,Object(b.jsx)(B.default.DisplayXLarge,{children:T+" ETH"})]}),Object(b.jsx)(H.FormatCurrency,{numbers:[null!=k?k:0,_],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:k?e:"-"})}})]}),Object(b.jsx)(N.default,{my:"4",children:Object(b.jsx)(M.default,{size:"xl",w:"full",type:"primary",onPress:I,children:s.formatMessage({id:"title__stake_str"},{0:"ETH"})})}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:s.formatMessage({id:"form__available_to_stake"})}),Object(b.jsxs)(B.default.Body2,{color:"text-subdued",children:[Object(m.formatAmount)(v,6)," ETH"]})]}),Object(b.jsx)(Xe,{}),Object(b.jsxs)(N.default,{mt:"2",children:[A?Object(b.jsxs)(N.default,{p:"4",borderRadius:12,bg:"surface-default",flexDirection:"row",alignItems:"center",mb:"2",children:[Object(b.jsx)(C.default,{w:"10",h:"10",bg:"surface-neutral-default",borderRadius:"full",mr:"2",children:Object(b.jsx)(P.default,{name:"InboxArrowDownMini",size:16})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1,{children:s.formatMessage({id:"form__str_is_activating"},{0:A+" ETH"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:s.formatMessage({id:"form__str_is_activating_eth_desc"},{0:"ETH",1:null!=(a=null==w?void 0:w.validator_alive_predicted_hour)?a:"24",3:(null!=(i=null==w?void 0:w.retail_deposit_far)?i:32).toFixed(2)+" ETH"})})]})]}):null,Object(b.jsx)(Ye,{}),Object(b.jsx)(Ze,{}),Object(b.jsx)(et,{})]}),Object(b.jsx)(N.default,{my:"2",children:Object(b.jsx)(B.default.Heading,{children:s.formatMessage({id:"form__reward_history"})})})]})},nt=function(e){var t,n=e.item,r=Object(u.default)(),o=Object(d.useRoute)().params.networkId,a=Object(q.useSimpleTokenPriceValue)({networkId:o});return Object(b.jsxs)(N.default,{w:"full",children:[Object(b.jsxs)(N.default,{justifyContent:"space-between",flexDirection:"row",mb:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:r.formatMessage({id:"title__reward"})}),Object(b.jsxs)(B.default.Body1Strong,{children:[$e(n.reward)," ETH"]})]}),Object(b.jsxs)(N.default,{justifyContent:"space-between",flexDirection:"row",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:Object(Qe.default)(new Date(n.date),"LLL dd yyyy")}),Object(b.jsx)(H.FormatCurrency,{numbers:[null!=a?a:0,null!=(t=n.reward)?t:0],render:function(e){return Object(b.jsx)(B.default.Body2,{ml:3,color:"text-subdued",children:a?e:"-"})}})]})]})},rt=function(e){var t,n=e.item,r=Object(u.default)(),o=Object(d.useRoute)().params.networkId,a=Object(q.useSimpleTokenPriceValue)({networkId:o}),i=Number(n.op_type),s=r.formatMessage({id:"action__stake"}),c="";return 1===i?(s=r.formatMessage({id:"form__staking"}),n.remain_time&&(c=r.formatMessage({id:"transaction__pending"}))):2===i?(s=r.formatMessage({id:"form__unstaking"}),n.remain_time&&(c=r.formatMessage({id:"transaction__pending"}))):3!==i&&4!==i||(s=r.formatMessage({id:"action__withdraw"})),Object(b.jsxs)(N.default,{w:"full",children:[Object(b.jsxs)(N.default,{justifyContent:"space-between",flexDirection:"row",mb:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:s}),Object(b.jsxs)(B.default.Body1Strong,{children:[$e(n.amount)," ETH"]})]}),Object(b.jsxs)(N.default,{justifyContent:"space-between",flexDirection:"row",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:Object(Qe.default)(Object($.default)(n.history_time,"yyyy-MM-dd HH:mm:ss",new Date),"LLL dd yyyy")}),c?Object(b.jsx)(N.default,{children:Object(b.jsx)(B.default.Body2,{color:"text-highlight",children:c})}):Object(b.jsx)(H.FormatCurrency,{numbers:[null!=a?a:0,null!=(t=n.amount)?t:0],render:function(e){return Object(b.jsx)(B.default.Body2,{ml:3,color:"text-subdued",children:a?e:"-"})}})]})]})},ot=function(){var e=Object(u.default)();return Object(b.jsx)(N.default,{py:"10",children:Object(b.jsx)(Le.default,{emoji:"\ud83d\udd50",title:e.formatMessage({id:"transaction__history_empty_title"}),subTitle:e.formatMessage({id:"reward__history_empty_desc"})})})};var at=n(13),it=n.n(at),st=n(833);function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=function(e){var t=new F.a(e);return t.lt("0.00000001")?Object(st.formatDecimalZero)(t.toNumber()):Object(m.formatAmount)(e,18)},lt=function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=ie(r,o),i=Object(c.useCallback)(T()((function*(){var e;if(a&&o){var n=(null!=(e=a.nfts)?e:[]).filter((function(e){return!e.isClaimed&&e.isFinalized})).map((function(e){return e.requestId})),i=yield L.default.serviceStaking.buildLidoClaimWithdrawals({requestIds:n,networkId:r}),s=yield L.default.engine.getAccount(o,r),c=dt(dt({},i),{},{from:s.address});t.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:Q.SendModalRoutes.SendConfirm,params:{accountId:s.id,networkId:r,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:c,onSuccess:function(e,t){var n;L.default.dispatch(Object(V.addTransaction)({accountId:s.id,networkId:r,transaction:{hash:e.txid,accountId:s.id,networkId:r,type:"lidoClaim",nonce:null==t||null==(n=t.decodedTx)?void 0:n.nonce,addedTime:Date.now()}}))}}}})}})),[t,a,r,o]);return a&&a.nfts&&a.nfts.length&&a.withdrawal&&Number(a.withdrawal)>0?Object(b.jsx)(He.default,{alertType:"info",title:Object(W.formatAmountExact)(a.withdrawal,4)+" ETH "+e.formatMessage({id:"form__available_for_claim"}),dismiss:!1,onAction:i,action:e.formatMessage({id:"form__claim"})}):null},ft=function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,n=t.networkId,r=t.accountId,o=Object(f.useAppSelector)((function(e){return e.staking.transactions})),a=Object(c.useMemo)((function(){var e,t;return o?(null!=(e=null==(t=o[r])?void 0:t[n])?e:[]).filter((function(e){return!e.archive})):[]}),[o,n,r]);return a.length>0?Object(b.jsxs)(N.default,{children:[Object(b.jsx)(He.default,{alertType:"info",title:e.formatMessage({id:"msg__there_are_str_requests_waiting_for_confirmation_currently"},{0:a.length}),dismiss:!1}),a.map((function(e){return Object(b.jsx)(Ge,{tx:e},e.hash)}))]}):null},mt=function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=ie(r,o),i=Object(q.useNativeToken)(r),l=Object(f.useTokenBalance)({networkId:r,accountId:o,token:i}),p=Object(d.useNavigation)(),h=Object(q.useSimpleTokenPriceValue)({networkId:r}),g=Object(c.useCallback)((function(){p.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstakeShouldUnderstand,params:{networkId:r,accountId:o}}})}),[p,r,o]),O=Object(c.useCallback)((function(){p.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthStakeShouldUnderstand,params:{readonly:!0,networkId:r,accountId:o}}})}),[p,r,o]),v=Object(c.useCallback)((function(){p.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHStake,params:{networkId:r,accountId:o,source:j.EthStakingSource.Lido}}})}),[p,r,o]),y=null!=(e=null==a?void 0:a.balance)?e:"0.00",k=Object(W.gt)(y,"0")?Object(m.formatAmount)(y,8):"0.00";return Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",w:"full",alignItems:"center",children:[Object(b.jsx)(B.default.Heading,{children:t.formatMessage({id:"content__total"})}),Object(b.jsx)(Ue.default,{type:"plain",name:"QuestionMarkCircleOutline",size:"sm",onPress:O})]}),Object(b.jsxs)(N.default,{mt:"2",children:[Object(b.jsx)(N.default,{flexDirection:"row",alignItems:"center",children:Object(b.jsx)(B.default.DisplayXLarge,{children:k+" stETH"})}),Object(b.jsx)(H.FormatCurrency,{numbers:[null!=h?h:0,y],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:h?e:"-"})}})]}),Object(b.jsxs)(N.default,{my:"4",flexDirection:"row",children:[Object(b.jsx)(N.default,{flex:"1",children:Object(b.jsx)(M.default,{size:"xl",w:"full",type:"primary",onPress:v,children:t.formatMessage({id:"action__stake"})})}),Object(b.jsx)(N.default,{w:"4"}),Object(b.jsx)(N.default,{flex:"1",children:Object(b.jsx)(M.default,{size:"xl",w:"full",onPress:g,children:t.formatMessage({id:"action__unstake"})})})]}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__available_to_stake"})}),Object(b.jsxs)(B.default.Body2,{color:"text-default",children:[Object(m.formatAmount)(l,6)," ETH"]})]}),Object(b.jsxs)(s.default,{space:"4",mt:"4",children:[Object(b.jsx)(lt,{}),Object(b.jsx)(ft,{})]}),Object(b.jsx)(N.default,{my:"2",children:Object(b.jsx)(B.default.Heading,{children:t.formatMessage({id:"form__active_request"})})})]})},pt=function(){var e=Object(u.default)();return Object(b.jsx)(N.default,{py:"10",children:Object(b.jsx)(Le.default,{emoji:"\ud83d\udd50",title:e.formatMessage({id:"empty__no_data"})})})};var jt=n(75),bt=n(1384),ht=n.n(bt),gt=n(47);function Ot(e){var t=e.title,n=e.titleAction,r=e.text,o=e.onChangeText,a=e.loading,i=e.desc;return Object(b.jsxs)(N.default,{height:"140px",children:[!!t&&Object(b.jsxs)(w.default,{space:2,alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(N.default,{opacity:0,children:n}),Object(b.jsx)(x.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:t}),n]}),Object(b.jsx)(C.default,{flex:1,maxH:"64px",mt:2,mb:3,children:Object(b.jsx)(U.AutoSizeText,{autoFocus:!0,text:r,onChangeText:o,placeholder:"0"})}),a?Object(b.jsx)(jt.default,{size:"sm"}):!!i&&Object(b.jsx)(x.default,{typography:"Body1Strong",textAlign:"center",isTruncated:!0,children:i})]})}function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kt=n(101);var wt=n(485),xt=n(238);function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var _t=Object(xt.default)(),Tt=[{name:j.StakingRoutes.StakingAmount,component:function(){var e=Object(u.default)(),t=(Object(G.default)().height,Object(a.default)()),n=Object(c.useState)(!1),r=A()(n,2),o=r[0],s=r[1],l=Object(d.useNavigation)(),m=Object(d.useRoute)().params,p=m.networkId,h=m.tokenIdOnNetwork,g=m.accountId,O=Object(c.useState)(""),v=A()(O,2),y=v[0],k=v[1],w=Object(f.useNetworkSimple)(p),_=Object(q.useSingleToken)(p,null!=h?h:"").token,S=Object(f.useTokenBalanceWithoutFrozen)({networkId:p,accountId:g,token:_,fallback:"0"}),R=Object(c.useCallback)((function(){if(!_||!y)return"error";var t,n,r=new F.a(y),o=new F.a(S);return r.isNaN()||o.isNaN()?e.formatMessage({id:"form__amount_invalid"},{0:null!=(t=null==_?void 0:_.symbol)?t:""}):o.isLessThan(r)?e.formatMessage({id:"form__amount_invalid"},{0:null!=(n=null==_?void 0:_.symbol)?n:""}):void 0}),[y,e,S,_])(),C=Object(c.useMemo)((function(){return new F.a("0.01")}),[]),P=Object(c.useMemo)((function(){if(!C.isNaN()&&C.gt("0")){var e=new F.a(y);if(e.isNaN())return[!1,!1];if(e.lt(C))return[!1,e.gt("0")]}return[!0,!1]}),[C,y]),E=A()(P,2),L=E[0],U=E[1],V=Object(c.useMemo)((function(){return U?Object(b.jsx)(B.default.Body1Strong,{color:"text-critical",children:e.formatMessage({id:"form__str_minimum_stake_amount"},{0:C.toFixed(),1:null==_?void 0:_.symbol})}):void 0}),[e,C,U,null==_?void 0:_.symbol]),z=function(e){var t,n,r,o=e.tokenInfo,a=e.desc,i=e.network,s=e.amount,d=e.setAmount,u=e.tokenBalance,l=null!=(t=null!=o&&o.tokenIdOnNetwork?null==i?void 0:i.tokenDisplayDecimals:null==i?void 0:i.nativeDisplayDecimals)?t:2,f=null!=(n=null==o?void 0:o.decimals)?n:18,m=Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,"+f+"})?$")}),[f]),p=Object(Be.useSettings)().selectedFiatMoneySymbol,j=(void 0===p?"usd":p).toUpperCase().trim(),h=Object(c.useState)(!1),g=A()(h,2),O=g[0],v=g[1],y=O?2:f,k=Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,"+y+"})?$")}),[y]),w=Object(q.useSimpleTokenPriceValue)({networkId:null==o?void 0:o.networkId,contractAdress:null==o?void 0:o.tokenIdOnNetwork}),I=Object(c.useState)(s),_=A()(I,2),T=_[0],S=_[1],R=Object(c.useMemo)((function(){return new F.a(null!=w?w:0)}),[w]),M=!R.isNaN()&&R.gt(0),C=Object(c.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return e?t?R.times(t||"0").toFixed(2,n):"":t}),[R]),N=Object(c.useCallback)((function(e){var t=C(O,e,F.a.ROUND_FLOOR);S(t)}),[C,O]),P=Object(c.useCallback)((function(e){if(e.length<s.length)d(e);else if(m.test(e))d(e);else{var t=new F.a(e);if(!t.isNaN()){var n=t.toFixed(f,F.a.ROUND_FLOOR);d(n)}}}),[s.length,f,d,m]),B=Object(b.jsx)(Ue.default,{name:"ArrowsUpDownOutline",size:"lg",type:"plain",circle:!0,onPress:function(){var e;T&&T===u&&!O&&(e=F.a.ROUND_FLOOR);var t=!O;v(t),S(C(t,s,e))}}),D=Object(c.useMemo)((function(){return a||(O?Object(b.jsxs)(x.default,{children:[(null==(e=Object(H.formatBalanceDisplay)(s||"0","",{fixed:l}))?void 0:e.amount)||s||"0"," ",null==o?void 0:o.symbol]}):Object(b.jsx)(H.FormatCurrencyToken,{token:o,value:s,render:function(e){return Object(b.jsx)(x.default,{children:e})}}));var e}),[s,l,a,O,o]);return Object(c.useEffect)((function(){return P(O?T?new F.a(T).div(R).toFixed():"":T)}),[O,P,T,R]),{validAmountRegex:m,title:null!=(r=O?j:null==o?void 0:o.symbol)?r:"--",titleAction:M?B:void 0,isFiatMode:O,descView:D,text:T,onTextChange:function(e){if(e.length<T.length)S(e);else if(k.test(e))S(e);else{var t=new F.a(e);if(!t.isNaN()){var n=t.toFixed(y,F.a.ROUND_FLOOR);S(n)}}},setTextByAmount:N}}({tokenInfo:_,desc:V,network:w,amount:y,setAmount:k,tokenBalance:S}),K=z.title,W=z.titleAction,J=z.descView,$=z.text,X=z.onTextChange,Y=(z.validAmountRegex,z.setTextByAmount),Z=z.isFiatMode;return Object(b.jsx)(i.default,{header:e.formatMessage({id:"title__stake_str"},{0:null==_?void 0:_.symbol.toUpperCase()}),primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!R||!L,isLoading:o},onPrimaryActionPress:T()((function*(){if(w&&_){var t=Z?y:$;try{s(!0),yield Object(gt.wait)(100),l.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleEthStakeShouldUnderstand,params:{networkId:_.networkId,accountId:g,tokenIdOnNetwork:_.tokenIdOnNetwork,amount:t}}})}catch(o){var n,r=o.key;if("form__amount_invalid"===(void 0===r?"":r))I.default.show({title:e.formatMessage({id:"form__amount_invalid"},{0:null!=(n=null==_?void 0:_.symbol)?n:""})})}finally{s(!1)}}})),children:Object(b.jsxs)(N.default,{flex:1,flexDirection:"column",style:{userSelect:"none"},children:[Object(b.jsx)(N.default,{py:t?4:void 0,my:6,flex:1,justifyContent:"center",children:Object(b.jsx)(Ot,{title:K,titleAction:W,desc:J,text:$,onChangeText:X})}),Object(b.jsxs)(N.default,{mt:"auto",children:[Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsxs)(N.default,{flex:1,children:[Object(b.jsx)(B.default.Caption,{color:"text-subdued",children:e.formatMessage({id:"content__available_balance"})}),Object(b.jsx)(N.default,{children:Object(b.jsx)(H.FormatBalanceToken,{token:_,render:function(e){return Object(b.jsx)(B.default.Body1Strong,{color:R&&y?"text-critical":"text-default",children:e})}})})]}),Object(b.jsx)(M.default,{isDisabled:Number(S)-.01<=0,onPress:function(){var e=Math.max(Number(S)-.01,0);Y(String(e))},children:e.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(N.default,{borderRadius:12,flexDirection:"row",px:"16px",py:"12px",mt:"3",mb:"3",borderWidth:Ve.default.hairlineWidth,borderColor:"border-subdued",children:[Object(b.jsx)(D.default,{w:"10",h:"10",source:ht.a,mr:"4"}),Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",children:[Object(b.jsx)(B.default.Body1,{children:"Kele Pool "}),Object(b.jsx)(B.default.Body1,{color:"text-success",children:"4.12% APY"})]}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"content__third_party_validator"})})]})]}),!1]})]})})}},{name:j.StakingRoutes.KeleEthStakeShouldUnderstand,component:function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=n.accountId,o=n.networkId,a=n.amount,s=Object(f.useNativeToken)(o),l=Object(c.useCallback)((function(){var e=t.getParent();null!=e&&e.canGoBack()&&e.goBack()}),[t]),m=Object(c.useCallback)(T()((function*(){var e=yield L.default.engine.getAccount(r,o);if(e&&s){try{yield L.default.serviceStaking.registerOnKele({payeeAddr:e.address,networkId:o})}catch(c){je.default.common.error("registerOnKele failed")}var n,i=new F.a(a).shiftedBy(s.decimals).toFixed(0);try{n=Oe(Oe({},yield L.default.serviceStaking.buildTxForStakingETHtoKele({value:i,networkId:o})),{},{from:e.address})}catch(d){return void I.default.show({title:d.message},{type:"error"})}l(),t.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{networkId:o,accountId:r,payloadInfo:{type:"InternalStake",stakeInfo:{tokenInfo:s,amount:a,accountAddress:e.address}},feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:n}}})}})),[o,a,r,t,s,l]);return Object(b.jsx)(i.default,{hideSecondaryAction:!0,primaryActionTranslationId:"action__confirm",primaryActionProps:{onPromise:m},scrollViewProps:{children:Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(C.default,{p:"6",children:[Object(b.jsx)(D.default,{w:"24",h:"24",source:he.a}),Object(b.jsx)(B.default.DisplayLarge,{my:"6",children:e.formatMessage({id:"title__eth_2_0_staking"})})]}),Object(b.jsx)(N.default,{children:Object(b.jsx)(N.default,{flexDirection:"row",mt:"5",children:Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"content__in_the_rare_event_staked_eth_will_be_lost"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",textBreakStrategy:"highQuality",children:e.formatMessage({id:"content__in_the_rare_event_staked_eth_will_be_lost_desc"})})]})})})]})}})}},{name:j.StakingRoutes.StakedETHOnKele,component:function(){var e=Object(d.useRoute)().params,t=e.networkId,n=e.accountId,r=ae(t,n);Object(c.useEffect)((function(){L.default.serviceStaking.fetchPendingWithdrawAmount({networkId:t,accountId:n}),L.default.serviceStaking.fetchMinerOverview({accountId:n,networkId:t}),L.default.serviceStaking.fetchKeleIncomeHistory({accountId:n,networkId:t}),L.default.serviceStaking.fetchKeleOpHistory({accountId:n,networkId:t}),L.default.serviceStaking.getDashboardGlobal({networkId:t})}),[]);var o=Object(c.useCallback)((function(e){var t=e.item,n=e.index;return Object(b.jsxs)(N.default,{py:"4",px:"6",bg:"surface-default",overflow:"hidden",borderTopRadius:0===n?12:void 0,borderBottomRadius:r&&n===r.length-1?12:void 0,children:[t.op?Object(b.jsx)(rt,{item:t.op}):null,t.income?Object(b.jsx)(nt,{item:t.income}):null]})}),[r]);return Object(b.jsx)(i.default,{height:"560px",footer:null,flatListProps:{data:null!=r?r:[],renderItem:o,ListHeaderComponent:tt,ListEmptyComponent:ot,ItemSeparatorComponent:qe.default,showsVerticalScrollIndicator:!1}})}},{name:j.StakingRoutes.UnstakeAmount,component:function(){var e,t,n,r,o=Object(u.default)(),a=(Object(G.default)().height,Object(d.useNavigation)()),s=Object(d.useRoute)().params,l=s.networkId,f=s.tokenIdOnNetwork,p=s.accountId,h=re(l),g=ne(l,p),O=te(l,p),v=Object(q.useSimpleTokenPriceValue)({networkId:l}),y=null!=(e=null==g?void 0:g.amount.retail_staked)?e:"0",k=null!=(t=null==h?void 0:h.retail_min_amount)?t:"0",_=null!=(n=null==O?void 0:O.estimate_use_sec)?n:60,S=oe(Math.floor(_/60)),R=Object(c.useState)(""),P=A()(R,2),D=P[0],E=P[1],V=Object(q.useSingleToken)(l,null!=f?f:"").token,z=Object(c.useMemo)((function(){if(!V||!D)return"error";var e=new F.a(D),t=new F.a(y),n=V.symbol;return e.isNaN()||t.isNaN()||t.isLessThan(e)?o.formatMessage({id:"form__amount_invalid"},{0:n}):void 0}),[D,o,y,V]),W=Object(c.useMemo)((function(){var e,t=new F.a(k),n=!t.isNaN()&&t.gt("0"),r=null!=(e=null==V?void 0:V.symbol)?e:"";if(n){var a=D.trim(),i=new F.a(a);if(a&&(i.isNaN()||i.gt(0)&&i.lt(t)))return o.formatMessage({id:"form__min_amount"})+" "+t.toFixed()+" "+r}}),[k,D,o,V]),J=(Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]),Object(c.useCallback)((function(e){var t=new F.a(y);if(!t.lte(0)){var n=e>=100?y:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);E(n)}}),[y]));return Object(b.jsx)(i.default,{header:o.formatMessage({id:"title__unstake_str"},{0:null==V?void 0:V.symbol.toUpperCase()}),headerDescription:"Kelepool",primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!z||!!W||new F.a(D).lte(0)},onPrimaryActionPress:T()((function*(){if(p&&V){var e=yield L.default.engine.getAccount(p,l),t={unstake_amt:D,address:e.address,type:"retail"},n={sign_time:Math.floor(Date.now()/1e3),token:"eth",addr:e.address,url:"/eth2/v2/miner/unstake",method:"post",api_param:t};a.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:e.id,networkId:V.networkId,unsignedMessage:{type:1,message:JSON.stringify(n)},onSuccess:function(){var e=T()((function*(e){var r=yield L.default.serviceStaking.unstake(yt(yt({},t),{},{networkId:V.networkId,pirvSignRaw:JSON.stringify(n),signHash:e}));0!==r.code&&r.message?I.default.show({title:r.message},{type:"error"}):(E(""),L.default.serviceStaking.fetchMinerOverview({networkId:l,accountId:p}),a.replace(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.Feedback,params:{networkId:l,accountId:p}}}))}));return function(t){return e.apply(this,arguments)}}()}}})}})),children:Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsxs)(N.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(C.default,{flex:"1",maxH:"140px",children:[Object(b.jsx)(x.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(r=null==V?void 0:V.symbol.toUpperCase())?r:""}),Object(b.jsx)(C.default,{flex:"1",minH:"30px",children:Object(b.jsx)(U.AutoSizeText,{autoFocus:!0,text:D,onChangeText:E,placeholder:"0"})}),Object(b.jsx)(C.default,{children:W?Object(b.jsx)(B.default.Body1Strong,{color:"text-critical",children:W}):Object(b.jsx)(H.FormatCurrency,{numbers:[null!=v?v:0,null!=D?D:0],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:v?e:"$ 0"})}})})]}),Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(M.default,{size:"sm",onPress:function(){return J(25)},children:"25%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return J(50)},children:"50%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return J(75)},children:"75%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return J(100)},children:o.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(N.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",mr:"1",children:o.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(B.default.Body2Strong,{color:z&&D?"text-critical":"text-default",children:[null!=y?y:""," ",null==V?void 0:V.symbol.toUpperCase()]})]})]})]}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__est_arrival_time"})}),Object(b.jsx)(B.default.Body2,{children:S})]})]}),!1]})})}},{name:j.StakingRoutes.KeleEthUnstakeShouldUnderstand,component:function(){var e=Object(u.default)(),t=Object(d.useNavigation)(),n=Object(d.useRoute)().params,r=Object(c.useCallback)((function(){n.readonly?t.goBack():t.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.UnstakeAmount,params:{accountId:n.accountId,networkId:n.networkId}}})}),[t,n]);return Object(b.jsx)(i.default,{header:e.formatMessage({id:"title__unstake_eth"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__i_got_it",onPrimaryActionPress:r,scrollViewProps:{children:Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(C.default,{p:"6",children:[Object(b.jsx)(D.default,{w:"24",h:"24",source:ye.a}),Object(b.jsx)(B.default.DisplayLarge,{mt:"6",mb:"2",children:e.formatMessage({id:"title__unstake_eth"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__the_unstaking_process_will_be_completed_in_two_stages"})})]}),Object(b.jsxs)(N.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",children:[Object(b.jsx)(C.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",mr:"4",children:Object(b.jsx)(B.default.Body2Strong,{color:"decorative-icon-one",children:"1"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"action__unstake"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__unstake_desc"})})]})]}),Object(b.jsxs)(N.default,{flexDirection:"row",mt:"5",children:[Object(b.jsx)(C.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",mr:"4",children:Object(b.jsx)(B.default.Body2Strong,{color:"decorative-icon-one",children:"2"})}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(B.default.Body1Strong,{children:e.formatMessage({id:"action__withdraw"})}),Object(b.jsx)(B.default.Body2,{color:"text-subdued",textBreakStrategy:"highQuality",children:e.formatMessage({id:"form__withdraw_desc"})})]})]})]})]})}})}},{name:j.StakingRoutes.WithdrawAmount,component:function(){var e,t,n,r,o=Object(u.default)(),a=Object(f.useNavigation)(),l=Object(d.useRoute)(),p=(Object(G.default)().height,l.params),h=p.networkId,g=p.tokenIdOnNetwork,O=p.accountId,v=Object(f.useAccount)({accountId:O,networkId:h}).account,y=function(e,t){return Object(c.useEffect)((function(){Object(W.isEvmNetworkId)(e)&&Object(X.isAccountCompatibleWithNetwork)(t,e)&&L.default.serviceStaking.fetchWithdrawOverview({networkId:e,accountId:t})}),[e,t]),Object(f.useAppSelector)((function(n){var r,o;return null==(r=n.staking.keleWithdrawOverviews)||null==(o=r[t])?void 0:o[e]}))}(h,O),k=Object(q.useSimpleTokenPriceValue)({networkId:h}),_=null!=(e=null==y?void 0:y.balance)?e:"0",S=null!=(t=null==y?void 0:y.user_fee)?t:"0",R=Object(c.useState)(""),P=A()(R,2),D=P[0],E=P[1],V=Object(q.useSingleToken)(h,null!=g?g:"").token,z=Object(c.useMemo)((function(){var e=new F.a(D),t=new F.a(S),n=e.minus(t);if(n.gt(0))return Object(m.formatAmount)(n,8)}),[D,S]),J=Object(c.useMemo)((function(){if(!V||!D)return"error";var e=new F.a(D),t=new F.a(_),n=V.symbol;return e.isNaN()||t.isNaN()||t.isLessThan(e)?o.formatMessage({id:"form__amount_invalid"},{0:n}):void 0}),[D,o,_,V]),$=Object(c.useMemo)((function(){var e,t=new F.a(S),n=!t.isNaN()&&t.gt("0"),r=D.trim(),a=null!=(e=null==V?void 0:V.symbol)?e:"";if(n&&r){var i=new F.a(r);if(i.isNaN()||i.gt(0)&&i.lte(t))return""+o.formatMessage({id:"form__field_large_than"},{0:t.toFixed()+" "+a})}}),[S,D,o,V]),Y=Object(c.useCallback)((function(e){var t=new F.a(_);if(!t.lte(0)){var n=e>=100?_:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);E(n)}}),[_]);return Object(c.useMemo)((function(){return new RegExp("^(0|([1-9][0-9]*))?\\.?([0-9]{1,18})?$")}),[]),Object(b.jsx)(i.default,{header:o.formatMessage({id:"action__withdraw"}),primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!J||!!$||new F.a(D).lte(0)},onPrimaryActionPress:T()((function*(){if(O&&V){var e=yield L.default.engine.getAccount(O,h),t={token:"eth",amount:D,address:e.address};a.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:O,networkId:V.networkId,unsignedMessage:{type:1,message:JSON.stringify(t)},onSuccess:function(){var e=T()((function*(){var e=yield L.default.serviceStaking.withdraw({accountId:O,networkId:h,amount:D});0!==e.code&&e.message?I.default.show({title:e.message},{type:"error"}):(E(""),L.default.serviceStaking.fetchPendingWithdrawAmount({accountId:O,networkId:h}),a.replace(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.Feedback,params:{networkId:h,accountId:O}}}))}));return function(){return e.apply(this,arguments)}}()}}})}})),children:Object(b.jsxs)(N.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(N.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(C.default,{flex:1,flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(C.default,{flex:1,maxH:"140px",children:[Object(b.jsx)(x.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(n=null==V?void 0:V.symbol.toUpperCase())?n:""}),Object(b.jsx)(C.default,{flex:"1",minH:"30px",children:Object(b.jsx)(U.AutoSizeText,{autoFocus:!0,text:D,onChangeText:E,placeholder:"0"})}),Object(b.jsx)(C.default,{children:$?Object(b.jsx)(B.default.Body1Strong,{color:"text-critical",children:$}):Object(b.jsx)(H.FormatCurrency,{numbers:[null!=k?k:0,null!=D?D:0],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:k?e:"$ 0"})}})})]}),Object(b.jsxs)(C.default,{children:[Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Y(25)},children:"25%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Y(50)},children:"50%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Y(75)},children:"75%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Y(100)},children:o.formatMessage({id:"action__max"})})]}),Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",justifyContent:"center",h:"8",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",mr:"1",children:o.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(B.default.Body2Strong,{color:J&&D?"text-critical":"text-default",children:[Object(m.formatAmount)(_,8)," ",null==V?void 0:V.symbol.toUpperCase()]})]})]})]}),Object(b.jsxs)(s.default,{space:"1",children:[Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"content__gas_fee"})}),Object(b.jsxs)(B.default.Body2,{children:[S," ",null==V?void 0:V.symbol.toUpperCase()]})]}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__receive_address"})}),Object(b.jsx)(B.default.Body2,{children:Object(kt.shortenAddress)(null!=(r=null==v?void 0:v.address)?r:"")})]}),z?Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:o.formatMessage({id:"form__actual_arrival"})}),Object(b.jsx)(B.default.Body2,{children:z})]}):null]})]}),!1]})})}},{name:j.StakingRoutes.Feedback,component:pe},{name:j.StakingRoutes.ETHPoolSelector,component:h},{name:j.StakingRoutes.LidoEthStakeShouldUnderstand,component:Se},{name:j.StakingRoutes.LidoEthUnstakeShouldUnderstand,component:Fe},{name:j.StakingRoutes.ETHStake,component:function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.accountId,o=n.networkId,a=n.source,s=Object(d.useNavigation)(),p=Object(q.useSimpleTokenPriceValue)({networkId:o}),h=Object(c.useState)(null!=a?a:j.EthStakingSource.Lido),O=A()(h,2),_=O[0],S=O[1],R=Object(c.useState)(j.KeleStakingMode.fast),D=A()(R,2),E=D[0],G=D[1],$=Object(c.useState)(!1),X=A()($,2),Y=X[0],Z=X[1],ee=function(e,t){var n=Object(f.useAppSelector)((function(e){return e.staking.ethStakingApr}));if(!n)return"";var r=t?null==n?void 0:n.testnet:n.mainnet;return e===j.EthStakingSource.Kele?Object(W.formatAmount)(r.kele,2):Object(W.formatAmount)(r.lido,2)}(_,o===l.OnekeyNetwork.goerli);Object(c.useEffect)((function(){ee||L.default.serviceStaking.fetchEthAprSma()}),[]);var te=Object(c.useState)(""),ne=A()(te,2),re=ne[0],oe=ne[1],ae=Object(q.useSingleToken)(o,"").token,ie=Object(f.useTokenBalanceWithoutFrozen)({networkId:o,accountId:r,token:ae,fallback:"0"}),se=Object(c.useMemo)((function(){if(!ae||!re)return"error";var e=new F.a(re),n=new F.a(ie),r=ae.symbol;return e.isNaN()||n.isNaN()||n.isLessThan(e)?t.formatMessage({id:"form__amount_invalid"},{0:r}):void 0}),[re,t,ie,ae]),le=Object(c.useMemo)((function(){var e,n=_===j.EthStakingSource.Kele?new F.a("0.01"):new F.a("0.0000001"),r=!n.isNaN()&&n.gt("0"),o=null!=(e=null==ae?void 0:ae.symbol)?e:"";if(r){var a=re.trim(),i=new F.a(a);if(a&&(i.isNaN()||i.gt(0)&&i.lt(n)))return t.formatMessage({id:"form__min_amount"})+" "+n.toFixed()+" "+o}}),[re,t,ae,_]),me=Object(c.useCallback)((function(e){var t=new F.a(ie);if(!t.lte(0)){var n=e>=100?ie:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);oe(n)}}),[ie]),pe=Object(c.useCallback)((function(){s.push(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.ETHPoolSelector,params:{networkId:o,accountId:r,onSelector:function(e){S(e);var t=s.getParent();t?t.goBack():s.goBack()}}}})}),[s,o,r]),je=Object(c.useCallback)((function(){s.push(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.KeleStakingModeSelector,params:{mode:E,networkId:o,onSelector:function(e){G(e);var t=s.getParent();t?t.goBack():s.goBack()}}}})}),[s,o,E]),be=Object(c.useCallback)(function(){var e=T()((function*(e){var n=e.stakingTx,a=e.onClose;if(n){var i,c=yield L.default.engine.getAccount(r,o);n&&(i=ce(ce({},n),{},{from:c.address})),i?ae&&(null==a||a(),s.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{networkId:o,accountId:r,payloadInfo:{type:"InternalStake",stakeInfo:{tokenInfo:ae,amount:re,accountAddress:c.address}},feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:ce(ce({},i),{},{from:null==c?void 0:c.address}),onSuccess:function(e,n){var a,i;_===j.EthStakingSource.Kele?L.default.dispatch(Object(V.addKeleTransaction)({accountId:c.id,networkId:o,transaction:{hash:e.txid,accountId:c.id,networkId:o,type:"KeleStake",amount:re,nonce:null==n||null==(a=n.decodedTx)?void 0:a.nonce,addedTime:Date.now()}})):(L.default.serviceStaking.addStEthToUserAccount({networkId:o,accountId:r}),L.default.dispatch(Object(V.addTransaction)({accountId:c.id,networkId:o,transaction:{hash:e.txid,accountId:c.id,networkId:o,type:"lidoStake",nonce:null==n||null==(i=n.decodedTx)?void 0:i.nonce,addedTime:Date.now()}})));I.default.show({title:t.formatMessage({id:"msg__success"})}),s.goBack()}}}})):I.default.show({title:"Failed to build encodedTx data"},{type:"error"})}else I.default.show({title:"Failed to build encodedTx data"},{type:"error"})}));return function(t){return e.apply(this,arguments)}}(),[ae,r,re,t,s,o,_]),he=Object(c.useCallback)(function(){var e=T()((function*(e){var t=e.onClose;if(r&&ae){var n,a=new F.a(re).shiftedBy(ae.decimals).toFixed(0);try{if(Z(!0),_===j.EthStakingSource.Kele)if(E===j.KeleStakingMode.fast){var i=yield L.default.serviceStaking.prepareBuildTxForFastStakingToKele({value:a,networkId:o});if(Object(W.gt)(re,i.fast_stake_balance)){var s=Object(W.minus)(re,i.fast_stake_balance).toString();return void Object(z.showOverlay)((function(e){return Object(b.jsx)(fe,{amount:re,remain:s,closeOverlay:e,onConfirm:T()((function*(){var e=i.fund_addr;yield L.default.validator.validateAddress(o,e),n={to:e,value:Object(W.toHex)(a),data:"0x"},be({stakingTx:n,onClose:t})}))})}))}var c=i.fund_addr;yield L.default.validator.validateAddress(o,c),n={to:c,value:Object(W.toHex)(a),data:"0x"}}else n=yield L.default.serviceStaking.buildTxForStakingETHtoKele({value:a,networkId:o});else n=yield L.default.serviceStaking.buildTxForStakingETHtoLido({value:a,networkId:o})}catch(d){return void I.default.show({title:d.message},{type:"error"})}finally{Z(!1)}be({stakingTx:n,onClose:t})}}));return function(t){return e.apply(this,arguments)}}(),[_,ae,o,r,re,E,be]);return Object(b.jsx)(i.default,{header:t.formatMessage({id:"title__stake_str"},{0:null==ae?void 0:ae.symbol.toUpperCase()}),primaryActionTranslationId:"action__stake",hideSecondaryAction:!0,primaryActionProps:{isLoading:Y,isDisabled:!!se||!!le||new F.a(re).lte(0)},onPrimaryActionPress:he,children:Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsx)(N.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(C.default,{flexGrow:"1",maxH:"140px",children:[Object(b.jsx)(x.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:null!=(e=null==ae?void 0:ae.symbol.toUpperCase())?e:""}),Object(b.jsx)(C.default,{flex:"1",minH:"30px",children:Object(b.jsx)(U.AutoSizeText,{autoFocus:!0,text:re,onChangeText:oe,placeholder:"0"})}),Object(b.jsx)(C.default,{children:le?Object(b.jsx)(B.default.Body1Strong,{color:"text-critical",children:le}):Object(b.jsx)(H.FormatCurrency,{numbers:[null!=p?p:0,null!=re?re:0],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:p?e:"$ 0"})}})})]}),Object(b.jsxs)(C.default,{flexGrow:"0.5",flexShrink:"1",flexDirection:"column",children:[Object(b.jsx)(N.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(M.default,{size:"sm",onPress:function(){return me(25)},children:"25%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return me(50)},children:"50%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return me(75)},children:"75%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return me(100)},children:t.formatMessage({id:"action__max"})})]}),Object(b.jsx)(N.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(N.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",mr:"1",children:t.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(B.default.Body2Strong,{color:se&&re?"text-critical":"text-default",children:[Object(m.formatAmount)(null!=ie?ie:"",6)," ",null==ae?void 0:ae.symbol.toUpperCase()]})]})]}),Object(b.jsxs)(N.default,{w:"full",flexGrow:"0.5",flexShrink:"1",children:[Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__apy"})}),ee?Object(b.jsxs)(B.default.Body2,{color:"text-success",children:[ee,"%"]}):Object(b.jsx)(N.default,{w:"6",h:"4",overflow:"hidden",borderRadius:12,children:Object(b.jsx)(k.default,{})})]}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__protocol"})}),Object(b.jsx)(y.default,{onPress:pe,children:Object(b.jsx)(de,{source:_})})]}),_===j.EthStakingSource.Kele?Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsxs)(N.default,{flexDirection:"row",alignItems:"center",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"content__mode"})}),Object(b.jsx)(N.default,{ml:"2",children:Object(b.jsx)(g.default,{trigger:function(e){var t=Object.assign({},(v()(e),e));return Object(b.jsx)(y.default,ce(ce({},t),{},{children:Object(b.jsx)(P.default,{name:"QuestionMarkCircleOutline",size:16,color:"icon-subdued"})}))},bodyProps:{children:Object(b.jsx)(x.default,{children:t.formatMessage({id:"msg__send_tokens_to_the_system_s_financing_address"})})}})})]}),Object(b.jsx)(y.default,{onPress:je,children:Object(b.jsx)(ue,{mode:E})})]}):null]})]})}),Object(b.jsx)(J,{text:re,onTextChange:oe})]})})}},{name:j.StakingRoutes.StakedETHOnLido,component:function(){var e=Object(u.default)(),t=Object(d.useRoute)().params,r=t.networkId,o=t.accountId;Object(c.useEffect)((function(){L.default.serviceStaking.fetchLidoOverview({networkId:r,accountId:o}),L.default.serviceStaking.fetchEthAprSma()}),[]);var a=ie(r,o),s=Object(c.useMemo)((function(){return a?(a.nfts?it()(a.nfts):[]).sort((function(e,t){return t.requestId-e.requestId})):[]}),[a]),l=Object(c.useCallback)((function(t){var r=t.item,o=t.index;return Object(b.jsx)(N.default,{py:"4",overflow:"hidden",borderTopRadius:0===o?12:void 0,borderBottomRadius:s&&o===s.length-1?12:void 0,flexDirection:"row",justifyContent:"space-between",children:Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",w:"full",children:[Object(b.jsx)(D.default,{w:"8",h:"8",borderRadius:"full",source:n(4186),mr:"2"}),Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsxs)(N.default,{w:"full",flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body1Strong,{mr:"2",children:e.formatMessage({id:"action_unstake"})}),Object(b.jsxs)(B.default.Body1Strong,{isTruncated:!0,children:["+",ut(r.stETH),"ETH"]})]}),Object(b.jsxs)(N.default,{w:"full",flexDirection:"row",justifyContent:"space-between",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:e.formatMessage({id:"form__est_str"},{0:e.formatMessage({id:"form__str_day"},{0:" 1 - 5"})})}),Object(b.jsx)(B.default.Body2,{color:"text-highlight",children:r.isFinalized?e.formatMessage({id:"form__available_for_claim"}):e.formatMessage({id:"transaction__pending"})})]})]})]})})}),[s,e]);return Object(b.jsx)(i.default,{height:"560px",footer:null,flatListProps:{data:s,renderItem:l,ListHeaderComponent:mt,ListEmptyComponent:pt,keyExtractor:function(e){return String(e.requestId)},ItemSeparatorComponent:qe.default,showsVerticalScrollIndicator:!1},children:Object(b.jsx)(mt,{})})}},{name:j.StakingRoutes.LidoEthUnstake,component:function(){var e,t=Object(u.default)(),n=Object(d.useRoute)().params,r=n.networkId,o=n.accountId,a=Object(d.useNavigation)(),l=Object(q.useSimpleTokenPriceValue)({networkId:r}),p=ie(r,o),h=null!=(e=null==p?void 0:p.balance)?e:"0",g=Object(f.useAppSelector)((function(e){return e.staking.stEthRate})),O=Object(c.useState)("lido"),v=A()(O,2),k=v[0],_=v[1],S=Object(c.useState)(""),R=A()(S,2),P=R[0],D=R[1],E=Object(c.useState)(!1),z=A()(E,2),W=z[0],G=z[1],$=Object(Re.useSwapSubmit)(),X=Object(c.useMemo)((function(){if(!P)return"error";var e=new F.a(P),n=new F.a(h);return e.isNaN()||n.isNaN()||n.isLessThan(e)?t.formatMessage({id:"form__amount_invalid"},{0:"stETH"}):void 0}),[P,t,h,"stETH"]),Y=Object(c.useMemo)((function(){var e="lido"===k?new F.a(1e-7):new F.a(1e-9),n=P.trim(),r=new F.a(n);if(e.gt(0)&&n&&(r.isNaN()||r.gt(0)&&r.lt(e)))return t.formatMessage({id:"form__min_amount"})+" "+e.toFixed()+" stETH"}),[P,t,"stETH",k]),Z=Object(c.useCallback)((function(e){var t=new F.a(h);if(!t.lte(0)){var n=e>=100?h:Object(m.formatAmount)(t.multipliedBy(e).dividedBy(100),8);D(n)}}),[h]),ee=Object(c.useCallback)(T()((function*(){var e=yield L.default.engine.getAccount(o,r);if(e&&r){var n=yield Object(Me.buildWithdrawStEthTransaction)({networkId:r,account:e,typedValue:P}),i=n.params,s=n.quote;yield $({params:i,quote:s,recipient:e,onSuccess:function(){var n=T()((function*(n){var i=n.result,s=n.decodedTx;L.default.dispatch(Object(V.addTransaction)({accountId:e.id,networkId:r,transaction:{hash:i.txid,accountId:e.id,networkId:r,type:"lidoUnstake",nonce:null==s?void 0:s.nonce,addedTime:Date.now()}})),a.replace(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnLido,params:{accountId:o,networkId:r}}}),I.default.show({title:t.formatMessage({id:"msg__success"})})}));return function(e){return n.apply(this,arguments)}}()})}})),[r,P,$,a,t,o]),te=Object(c.useCallback)(T()((function*(){var e=yield L.default.serviceStaking.getStEthToken({networkId:r}),n=new F.a(P).shiftedBy(e.decimals).toFixed(0),i=Math.floor(Date.now()/1e3)+86400,s=yield L.default.serviceStaking.buildStEthPermit({accountId:o,networkId:r,value:n,deadline:i});s?a.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SignMessageConfirm,params:{accountId:o,networkId:r,hideToast:!0,unsignedMessage:{type:4,message:s},closeImmediately:!0,onSuccess:function(){var e=T()((function*(e){var s="0x"+e.substring(2).substring(0,64),c="0x"+e.substring(2).substring(64,128),d=parseInt(e.substring(2).substring(128,130),16),u=yield L.default.engine.getAccount(o,r),l=Ne(Ne({},yield L.default.serviceStaking.buildRequestWithdrawalsWithPermit({networkId:r,amounts:[n],owner:u.address,permit:{v:d,s:c,r:s,value:n,deadline:i}})),{},{from:u.address});setTimeout((function(){a.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Send,params:{screen:K.SendModalRoutes.SendConfirm,params:{accountId:u.id,networkId:r,feeInfoEditable:!0,feeInfoUseFeeInTx:!1,encodedTx:l,onSuccess:function(e,n){var i;I.default.show({title:t.formatMessage({id:"msg__success"})}),L.default.dispatch(Object(V.addTransaction)({accountId:u.id,networkId:r,transaction:{hash:e.txid,accountId:u.id,networkId:r,type:"lidoUnstake",nonce:null==n||null==(i=n.decodedTx)?void 0:i.nonce,addedTime:Date.now()}})),a.replace(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.StakedETHOnLido,params:{accountId:o,networkId:r}}})}}}})}),10)}));return function(t){return e.apply(this,arguments)}}()}}}):I.default.show({title:t.formatMessage({id:"form__failed"})},{type:"error"})})),[r,P,a,t,o]),ne=Object(c.useCallback)(T()((function*(){try{G(!0),"onekey"===k?yield ee():yield te()}finally{G(!1)}})),[k,ee,te]),re=Object(c.useCallback)((function(){a.navigate(Q.RootRoutes.Modal,{screen:Q.ModalRoutes.Staking,params:{screen:j.StakingRoutes.LidoEthUnstakeRoutes,params:{source:k,amount:P,accountId:o,networkId:r,onSelector:function(e){_(e),a.goBack()}}}})}),[k,a,P,r,o]),oe=Object(c.useMemo)((function(){if("lido"!==k)return null==g?void 0:g[r]}),[k,g,r]);return Object(b.jsx)(i.default,{header:t.formatMessage({id:"title__unstake_str"},{0:"stETH"}),headerDescription:"Lido",primaryActionTranslationId:"action__next",hideSecondaryAction:!0,primaryActionProps:{isDisabled:!!X||new F.a(P).lte(0),onPress:ne,isLoading:W},children:Object(b.jsxs)(N.default,{flex:"1",children:[Object(b.jsxs)(N.default,{flex:"1",flexDirection:"column",justifyContent:"space-between",children:[Object(b.jsxs)(C.default,{flex:"1",flexDirection:"column",justifyContent:"space-around",children:[Object(b.jsxs)(C.default,{flex:"1",maxH:"140px",children:[Object(b.jsx)(x.default,{textAlign:"center",typography:"DisplayLarge",color:"text-subdued",children:"stETH"}),Object(b.jsx)(C.default,{flex:"1",minH:"30px",children:Object(b.jsx)(U.AutoSizeText,{autoFocus:!0,text:P,onChangeText:D,placeholder:"0"})}),Object(b.jsx)(C.default,{children:Y?Object(b.jsx)(B.default.Body1Strong,{color:"text-critical",children:Y}):Object(b.jsx)(H.FormatCurrency,{numbers:[null!=l?l:0,null!=P?P:0],render:function(e){return Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:l?e:"$ 0"})}})})]}),Object(b.jsxs)(C.default,{children:[Object(b.jsx)(N.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(w.default,{flexDirection:"row",alignItems:"center",space:"3",children:[Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Z(25)},children:"25%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Z(50)},children:"50%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Z(75)},children:"75%"}),Object(b.jsx)(M.default,{size:"sm",onPress:function(){return Z(100)},children:t.formatMessage({id:"action__max"})})]}),Object(b.jsx)(N.default,{h:"1",flexShrink:"1"}),Object(b.jsxs)(N.default,{h:"8",flexDirection:"row",alignItems:"center",justifyContent:"center",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",mr:"1",children:t.formatMessage({id:"content__available_balance"})}),Object(b.jsxs)(B.default.Body2Strong,{color:X&&P?"text-critical":"text-default",children:[Object(m.formatAmount)(null!=h?h:"",6)," ","stETH"]})]})]})]}),Object(b.jsxs)(s.default,{children:[Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__est_arrival_time"})}),Object(b.jsx)(B.default.Body2Strong,{children:"lido"===k?t.formatMessage({id:"form__str_day"},{0:"~ 1 - 3"}).toLowerCase():t.formatMessage({id:"content__str_minutes_plural"},{0:"~ 1-5"})})]}),Object(b.jsx)(Ae.default,{children:oe?Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__est_receipt"})}),Object(b.jsxs)(B.default.Body2Strong,{children:[new F.a(oe).multipliedBy(P).toFixed(),"ETH"]})]}):null}),Object(b.jsxs)(N.default,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",h:"10",children:[Object(b.jsx)(B.default.Body2,{color:"text-subdued",children:t.formatMessage({id:"form__route"})}),Object(b.jsx)(y.default,{onPress:re,children:Object(b.jsx)(Pe,{value:k})})]})]})]}),Object(b.jsx)(J,{text:P,onTextChange:D})]})})}},{name:j.StakingRoutes.LidoEthUnstakeRoutes,component:De},{name:j.StakingRoutes.KeleStakingModeSelector,component:xe}];t.default=function(){var e=Object(a.default)();return Object(b.jsx)(_t.Navigator,{screenOptions:function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({headerShown:!1},Object(wt.buildModalStackNavigatorOptions)({isVerticalLayout:e,navInfo:t}))},children:Tt.map((function(e){return Object(b.jsx)(_t.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);